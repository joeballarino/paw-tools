<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProAgent Works Signature Creator</title>
  <style>
    :root {
      --bg: #0f1420;
      --panel: #161d2b;
      --panel-2: #1b2436;
      --text: #e8ecf3;
      --muted: #aeb8cb;
      --line: #283249;
      --accent: #2f6fed;
      --danger: #f87171;
      --ok: #34d399;
      --radius: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.4;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
    }

    .top-controls, .grid > section {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px;
      margin-bottom: 12px;
    }

    .top-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: start;
    }

    .privacy-line {
      grid-column: 1 / -1;
      font-size: 14px;
      color: var(--muted);
    }

    .privacy-line button {
      background: transparent;
      color: var(--text);
      border: 0;
      text-decoration: underline;
      padding: 0;
      cursor: pointer;
      font: inherit;
    }

    .field {
      display: grid;
      gap: 6px;
      margin-bottom: 10px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    label { font-size: 13px; color: var(--muted); }

    input, select, textarea, button {
      font: inherit;
    }

    input, select, textarea {
      width: 100%;
      background: var(--panel-2);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 9px 10px;
      outline: none;
    }

    input[type="color"] {
      height: 36px;
      padding: 4px;
    }

    textarea { min-height: 64px; resize: vertical; }

    h1 {
      margin: 0 0 10px;
      font-size: 22px;
    }

    h2 {
      margin: 0 0 12px;
      font-size: 17px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 12px;
      align-items: start;
    }

    .swatches {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .swatch {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 2px solid transparent;
      cursor: pointer;
    }

    .swatch.active { border-color: #fff; }

    .subtle {
      color: var(--muted);
      font-size: 12px;
    }

    details {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      margin: 10px 0;
      background: #131b2a;
    }

    details > summary {
      cursor: pointer;
      list-style: none;
      font-weight: 600;
      font-size: 14px;
    }

    details > summary::-webkit-details-marker { display: none; }

    .accordion-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-radius: 8px;
      padding: 3px 6px;
      transition: background 0.18s ease;
    }

    .accordion-summary:hover {
      background: color-mix(in srgb, var(--panel-2), #fff 8%);
    }

    .accordion-chevron {
      width: 16px;
      height: 16px;
      flex: 0 0 16px;
      transition: transform 0.18s ease;
    }

    details[open] > summary .accordion-chevron {
      transform: rotate(180deg);
    }

    #previewDesktopAnchor,
    #previewMobileAnchor {
      display: none;
    }

    .preview-panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px;
      margin-bottom: 12px;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
    }

    .preview-card {
      background: #fff;
      color: #111;
      border-radius: 10px;
      overflow: auto;
      padding: 12px;
      border: 1px solid #d1d5db;
      min-height: 220px;
    }

    .actions {
      display: grid;
      gap: 8px;
      margin-top: 10px;
    }

    .copy-status {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
    }

    .manual-copy-target {
      outline: 2px solid var(--danger);
      outline-offset: 2px;
      transition: outline-color 0.3s ease;
    }

    button {
      border: 1px solid var(--line);
      background: var(--panel-2);
      color: var(--text);
      border-radius: 8px;
      padding: 9px 12px;
      cursor: pointer;
    }

    button.primary {
      border-color: color-mix(in srgb, var(--accent), #000 20%);
      background: var(--accent);
      color: #fff;
    }

    button:disabled { opacity: 0.6; cursor: not-allowed; }

    .status {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
    }

    .toast {
      position: fixed;
      right: 12px;
      bottom: 12px;
      background: #111827;
      color: #fff;
      border: 1px solid #374151;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      opacity: 0;
      transform: translateY(8px);
      transition: 0.2s ease;
      pointer-events: none;
      max-width: 290px;
      z-index: 60;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 12px;
    }

    .modal-backdrop.open { display: flex; }

    .modal {
      width: min(620px, 100%);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
    }

    .modal h3 { margin: 0 0 10px; }
    .modal ul { margin: 0 0 12px 18px; color: var(--muted); }
    .modal .row { display: flex; gap: 8px; justify-content: flex-end; }

    @media (max-width: 980px) {
      .top-controls,
      .grid,
      .field-row {
        grid-template-columns: 1fr;
      }

      .preview-panel { margin-top: 2px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Email Signature Creator</h1>

    <div class="top-controls">
      <div class="field">
        <label for="style">Style</label>
        <select id="style">
          <option value="clean" selected>Clean</option>
          <option value="compact">Compact</option>
          <option value="paw">ProAgent Member</option>
        </select>
      </div>

      <div>
        <label>Accent color</label>
        <div class="swatches" id="swatches"></div>
        <div class="field">
          <input type="color" id="accentCustom" value="#2f6fed" aria-label="Custom accent color" />
        </div>
      </div>

      <div class="privacy-line">
        <strong>Privacy-first: we don’t store or email your contact info.</strong>
        <button id="learnWhy" type="button">Learn why</button>
      </div>
    </div>

    <div class="grid">
      <section id="accordionPanel">
        <details id="contactSection" open>
          <summary class="accordion-summary">Contact details <svg class="accordion-chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M4 6.5 8 10l4-3.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></summary>
          <div class="field"><label for="fullName">Full name</label><input id="fullName" /></div>
          <div class="field-row">
            <div class="field"><label for="title">Title</label><input id="title" /></div>
            <div class="field"><label for="brokerage">Brokerage / Team</label><input id="brokerage" /></div>
          </div>
          <div class="field-row">
            <div class="field"><label for="phone">Phone</label><input id="phone" /></div>
            <div class="field"><label for="email">Email</label><input id="email" type="email" /></div>
          </div>
          <div class="field-row">
            <div class="field"><label for="website">Website</label><input id="website" placeholder="example.com" /></div>
            <div class="field"><label for="officeLocation">Office/location line (City, State) (optional)</label><input id="officeLocation" /></div>
          </div>
          <div class="field"><label for="license">License # (optional)</label><input id="license" /></div>
        </details>

        <div id="previewMobileAnchor"></div>

        <details id="socialSection">
          <summary class="accordion-summary">Social icons <svg class="accordion-chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M4 6.5 8 10l4-3.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></summary>
          <div class="field-row">
            <div class="field"><label for="linkedin">LinkedIn URL (optional)</label><input id="linkedin" placeholder="https://" /></div>
            <div class="field"><label for="instagram">Instagram URL (optional)</label><input id="instagram" placeholder="https://" /></div>
          </div>
          <div class="field-row">
            <div class="field"><label for="facebook">Facebook URL (optional)</label><input id="facebook" placeholder="https://" /></div>
            <div class="field"><label for="youtube">YouTube URL (optional)</label><input id="youtube" placeholder="https://" /></div>
          </div>
        </details>

        <details id="imageSection">
          <summary class="accordion-summary">Image / logo <svg class="accordion-chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M4 6.5 8 10l4-3.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></summary>
          <div class="field-row">
            <div class="field">
              <label for="imageType">Image type</label>
              <select id="imageType"><option>Logo</option><option>Headshot</option></select>
            </div>
            <div class="field">
              <label for="imageShape">Shape</label>
              <select id="imageShape"><option>Square</option><option selected>Rounded square</option><option>Circle</option></select>
            </div>
          </div>
          <div class="field-row">
            <div class="field">
              <label for="imageLayout">Layout</label>
              <select id="imageLayout"><option selected>Side-by-side (image left)</option></select>
            </div>
            <div class="field">
              <label for="imageSize">Size</label>
              <select id="imageSize"><option>Small</option><option>Medium</option><option>Large</option></select>
            </div>
          </div>
          <div class="field-row">
            <div class="field" style="grid-column: 1 / -1;"><label for="imageUrl">Image URL</label><input id="imageUrl" placeholder="https://" /><div class="subtle">Clear the URL to remove the image.</div></div>
          </div>
        </details>

        <details id="taglineSection">
          <summary class="accordion-summary">Tagline + mini bio (optional) <svg class="accordion-chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M4 6.5 8 10l4-3.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></summary>
          <div class="field"><label for="tagline">Tagline (short)</label><input id="tagline" /></div>
          <div class="field"><label for="bio">Bio / disclosure (footer)</label><textarea id="bio"></textarea><div class="subtle">Appears across the bottom of the signature.</div></div>
        </details>
      </section>

      <div id="previewDesktopAnchor"></div>

      <section class="preview-panel" id="previewPanel">
        <h2>Preview + Copy</h2>
        <div class="preview-card" id="preview" tabindex="-1"></div>
        <div class="actions">
          <button class="primary" id="copyPaste" type="button">Copy for paste (recommended)</button>
          <button id="copyGmail" type="button">Copy for Gmail</button>
          <button id="copyHtml" type="button">Copy HTML (advanced)</button>
        </div>
        <div class="copy-status" id="copyStatus" aria-live="polite"></div>

        <details id="copyHelp">
          <summary>Which one do I need?</summary>
          <ul class="subtle">
            <li><strong>Copy for paste:</strong> most signature editors where you paste formatted content.</li>
            <li><strong>Copy for Gmail:</strong> for Gmail signature settings.</li>
            <li><strong>Copy HTML:</strong> systems that ask for HTML source/import.</li>
            <li>If formatting is stripped: try Copy HTML import; otherwise your email client likely only supports plain text signatures.</li>
          </ul>
        </details>
      </section>
    </div>
  </div>

  <div class="modal-backdrop" id="privacyModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="privacyTitle">
      <h3 id="privacyTitle">Privacy & trust</h3>
      <ul>
        <li><strong>Your info stays in your browser.</strong> This tool doesn’t require an account and doesn’t store your form inputs on our servers.</li>
        <li><strong>No surprise outreach.</strong> Using this tool won’t add you to a list and won’t trigger marketing emails.</li>
        <li><strong>We’re earning trust on purpose.</strong> ProAgent Works is built to do what it says—so you can feel confident using the full suite when you’re ready.</li>
      </ul>
      <div class="row">
        <a href="https://www.proagentworks.com/join" target="_blank" rel="noopener noreferrer" style="color: var(--muted);">Learn about ProAgent Works</a>
        <button id="closeModal" type="button">Close</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    (function enforceEmbedOnly() {
      try {
        if (window.top === window.self) {
          window.location.replace("https://www.proagentworks.com/signature");
        }
      } catch (_) {
        window.location.replace("https://www.proagentworks.com/signature");
      }
    })();

    const state = {
      accent: "#2f6fed"
    };

    const swatches = ["#2f6fed", "#1f9d72", "#9b59b6", "#ef4444", "#f59e0b", "#06b6d4", "#64748b", "#111827"];

    const ids = [
      "style", "accentCustom", "fullName", "title", "brokerage", "phone", "email", "website", "officeLocation", "license",
      "linkedin", "instagram", "facebook", "youtube", "imageType", "imageUrl", "imageShape", "imageLayout", "imageSize",
      "tagline", "bio"
    ];

    const el = Object.fromEntries(ids.map((id) => [id, document.getElementById(id)]));
    const preview = document.getElementById("preview");
    const toast = document.getElementById("toast");
    const copyStatus = document.getElementById("copyStatus");
    const previewPanel = document.getElementById("previewPanel");
    const accordionPanel = document.getElementById("accordionPanel");
    const previewMobileAnchor = document.getElementById("previewMobileAnchor");
    const previewDesktopAnchor = document.getElementById("previewDesktopAnchor");
    const mobileLayoutMq = window.matchMedia("(max-width: 980px)");

    function showToast(message, isError = false) {
      toast.textContent = message;
      toast.style.borderColor = isError ? "#7f1d1d" : "#374151";
      toast.classList.add("show");
      scheduleResize();
      setTimeout(() => {
        toast.classList.remove("show");
        scheduleResize();
      }, 2200);
    }

    let resizeFrame = null;
    function postHeight() {
      const height = Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight,
        document.body.offsetHeight,
        document.documentElement.offsetHeight
      );
      window.parent.postMessage({ type: "paw:resize", height }, "*");
    }

    function scheduleResize(delay = 0) {
      if (resizeFrame) {
        clearTimeout(resizeFrame);
      }
      resizeFrame = setTimeout(() => {
        requestAnimationFrame(postHeight);
      }, delay);
    }

    function placePreviewPanel() {
      if (mobileLayoutMq.matches) {
        if (previewPanel.parentElement !== accordionPanel) {
          accordionPanel.insertBefore(previewPanel, previewMobileAnchor.nextSibling);
        }
      } else if (previewPanel.previousElementSibling !== previewDesktopAnchor || previewPanel.parentElement !== previewDesktopAnchor.parentElement) {
        previewDesktopAnchor.parentElement.insertBefore(previewPanel, previewDesktopAnchor.nextSibling);
      }
      scheduleResize(30);
    }

    new ResizeObserver(() => scheduleResize()).observe(document.body);
    new MutationObserver(() => scheduleResize(30)).observe(document.body, { subtree: true, childList: true, attributes: true });
    window.addEventListener("resize", () => scheduleResize(30));

    function safe(v) {
      return String(v || "").replace(/[&<>"]/g, (ch) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[ch]));
    }

    function normUrl(url) {
      const v = (url || "").trim();
      if (!v) return "";
      return /^https?:\/\//i.test(v) ? v : `https://${v}`;
    }


    const PAW_DEFAULT_IMAGE_URL = "https://paw-tools.pages.dev/siglogoreal.png";

    function hasValidImageUrl(value) {
      const normalized = normUrl(value);
      if (!normalized) return false;
      try {
        const parsed = new URL(normalized);
        return parsed.protocol === "http:" || parsed.protocol === "https:";
      } catch (_) {
        return false;
      }
    }

    function icon(name, color) {
      const common = `width="20" height="20" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"`;
      if (name === "linkedin") return `<svg ${common}><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zM4.943 13.5V6.169H2.542V13.5zM3.743 5.13c.837 0 1.358-.554 1.358-1.248-.015-.709-.521-1.248-1.342-1.248S2.4 3.173 2.4 3.882c0 .694.52 1.248 1.327 1.248zm9.757 8.37h-2.4V9.859c0-.915-.327-1.54-1.145-1.54-.625 0-.996.42-1.16.826-.06.146-.075.35-.075.554V13.5h-2.4s.03-6.168 0-6.807h2.4v.965c.319-.492.889-1.193 2.165-1.193 1.58 0 2.765 1.03 2.765 3.244z"/></svg>`;
      if (name === "instagram") return `<svg ${common}><path d="M8 0C5.829 0 5.555.01 4.703.048 3.85.088 3.269.222 2.76.42a5.4 5.4 0 0 0-1.95 1.27A5.4 5.4 0 0 0 .42 2.76c-.198.509-.332 1.09-.372 1.943C.01 5.555 0 5.829 0 8s.01 2.445.048 3.297c.04.853.174 1.434.372 1.943q.297.764.81 1.374a5.4 5.4 0 0 0 1.53 1.23c.509.198 1.09.332 1.943.372C5.555 15.99 5.829 16 8 16s2.445-.01 3.297-.048c.853-.04 1.434-.174 1.943-.372a5.4 5.4 0 0 0 1.374-.81 5.4 5.4 0 0 0 1.23-1.53c.198-.509.332-1.09.372-1.943C15.99 10.445 16 10.171 16 8s-.01-2.445-.048-3.297c-.04-.853-.174-1.434-.372-1.943a5.4 5.4 0 0 0-.81-1.374 5.4 5.4 0 0 0-1.53-1.23c-.509-.198-1.09-.332-1.943-.372C10.445.01 10.171 0 8 0m0 1.441c2.134 0 2.387.008 3.232.046.78.036 1.203.166 1.485.275.374.145.64.317.92.597s.452.546.597.92c.109.282.239.705.275 1.485.038.845.046 1.098.046 3.232s-.008 2.387-.046 3.232c-.036.78-.166 1.203-.275 1.485a3.95 3.95 0 0 1-.597.92 3.95 3.95 0 0 1-.92.597c-.282.109-.705.239-1.485.275-.845.038-1.098.046-3.232.046s-2.387-.008-3.232-.046c-.78-.036-1.203-.166-1.485-.275a3.95 3.95 0 0 1-.92-.597 3.95 3.95 0 0 1-.597-.92c-.109-.282-.239-.705-.275-1.485C1.449 10.387 1.441 10.134 1.441 8s.008-2.387.046-3.232c.036-.78.166-1.203.275-1.485.145-.374.317-.64.597-.92s.546-.452.92-.597c.282-.109.705-.239 1.485-.275C5.613 1.449 5.866 1.441 8 1.441m0 2.456A4.103 4.103 0 1 0 12.103 8 4.103 4.103 0 0 0 8 3.897m0 6.765A2.662 2.662 0 1 1 10.662 8 2.662 2.662 0 0 1 8 10.662m5.224-7.89a.96.96 0 1 1-.96.96.96.96 0 0 1 .96-.96"/></svg>`;
      if (name === "facebook") return `<svg ${common}><path d="M16 8.049C16 3.603 12.418 0 8 0S0 3.603 0 8.049C0 12.067 2.925 15.397 6.75 16v-5.625H4.719V8.049H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.875 0 1.79.157 1.79.157v1.98h-1.01c-.994 0-1.303.621-1.303 1.258v1.51h2.219l-.355 2.326H9.25V16C13.075 15.397 16 12.067 16 8.049"/></svg>`;
      return `<svg ${common}><path d="M8.051 1.999h-.103c-1.077.005-4.407.056-5.93.47-.46.124-.821.485-.945.945-.414 1.523-.465 4.853-.47 5.93v.103c.005 1.077.056 4.407.47 5.93.124.46.486.821.945.945 1.523.414 4.853.465 5.93.47h.103c1.077-.005 4.407-.056 5.93-.47.46-.124.821-.486.945-.945.414-1.523.465-4.853.47-5.93v-.103c-.005-1.077-.056-4.407-.47-5.93a1.34 1.34 0 0 0-.945-.945c-1.523-.414-4.853-.465-5.93-.47M6.545 11.4V6.6L10.727 9z"/></svg>`;
    }

    function buildSignatureHtml(gmailVariant = false) {
      const data = Object.fromEntries(Object.entries(el).map(([k, node]) => [k, node.type === "checkbox" ? node.checked : node.value.trim()]));
      const isLogo = data.imageType === "Logo";
      const imageSize = isLogo ? (data.imageSize === "Large" ? 112 : (data.imageSize === "Medium" ? 92 : 72)) : (data.imageSize === "Large" ? 86 : (data.imageSize === "Medium" ? 72 : 56));
      const imageRadius = data.imageShape === "Circle" ? "50%" : (data.imageShape === "Square" ? "0" : "10px");
      const imageFit = isLogo ? "contain" : "cover";
      const contactRows = [];

      if (data.phone) contactRows.push(`<span style="color:#4b5563;font-weight:600;">Phone:</span> <a href="tel:${safe(data.phone)}" style="color:${state.accent};text-decoration:none;">${safe(data.phone)}</a>`);
      if (data.email) contactRows.push(`<span style="color:#4b5563;font-weight:600;">Email:</span> <a href="mailto:${safe(data.email)}" style="color:${state.accent};text-decoration:none;">${safe(data.email)}</a>`);
      if (data.website) contactRows.push(`<span style="color:#4b5563;font-weight:600;">Web:</span> <a href="${safe(normUrl(data.website))}" style="color:${state.accent};text-decoration:none;">${safe(data.website)}</a>`);
      if (data.officeLocation) contactRows.push(`<span>${safe(data.officeLocation)}</span>`);
      if (data.license) contactRows.push(`<span>License # ${safe(data.license)}</span>`);

      const social = [
        ["linkedin", data.linkedin, "LinkedIn"],
        ["instagram", data.instagram, "Instagram"],
        ["facebook", data.facebook, "Facebook"],
        ["youtube", data.youtube, "YouTube"]
      ].filter(([, url]) => url).map(([key, url, label]) => (
        `<a href="${safe(normUrl(url))}" title="${label}" aria-label="${label}" style="display:inline-block;margin-right:10px;text-decoration:none;color:${state.accent};">${icon(key, state.accent)}</a>`
      )).join("");

      const tagline = safe((data.tagline || "").slice(0, 120));
      const bio = safe((data.bio || "").slice(0, 220));

      const spacer = gmailVariant ? "8" : "10";
      const fontBody = data.style === "compact" ? 12 : 13;
      const nameSize = data.style === "compact" ? 18 : 20;
      const normalizedImageUrl = normUrl(data.imageUrl);
      const hasImage = hasValidImageUrl(data.imageUrl);
      const showDivider = hasImage;

      const imageContainerStyle = isLogo
        ? "display:block;background:#ffffff;"
        : "display:block;padding:4px;border:1px solid #d1d5db;border-radius:8px;background:#ffffff;";

      const imageFrame = hasImage
        ? `<div style="${imageContainerStyle}"><img src="${safe(normalizedImageUrl)}" alt="${safe(data.imageType || "Image")}" width="${imageSize}" height="${imageSize}" style="display:block;border:0;outline:none;text-decoration:none;width:${imageSize}px;height:${imageSize}px;border-radius:${imageRadius};object-fit:${imageFit};object-position:center center;background:#ffffff;" /></div>`
        : "";

      const sideBySideTextCell = `<td style="vertical-align:top;${hasImage ? "padding-left:10px;" : ""}${showDivider ? "border-left:1px solid #d1d5db;" : ""}">
      <div style="font-size:${nameSize}px;font-weight:bold;color:#111;margin:0 0 1px;">${safe(data.fullName || "Your Name")}</div>
      <div style="font-size:${fontBody}px;color:#111827;font-weight:600;margin:0 0 4px;">${safe(data.title)}${data.title && data.brokerage ? " | " : ""}${safe(data.brokerage)}</div>
      ${tagline ? `<div style="font-size:${fontBody}px;color:${state.accent};margin:0 0 4px;">${tagline}</div>` : ""}
      <div style="font-size:${fontBody}px;color:#333;">${contactRows.join("<br />")}</div>
      ${social ? `<div style="margin-top:8px;">${social}</div>` : ""}
    </td>`;

      const contentRows = `<tr>${hasImage ? `<td style="vertical-align:top;padding-right:${spacer}px;">${imageFrame}</td>` : ""}${sideBySideTextCell}</tr>`;
      const footerRow = bio
        ? `<tr><td${hasImage ? " colspan=\"2\"" : ""} style="font-size:${fontBody}px;color:#444;line-height:1.35;padding-top:8px;white-space:normal;word-break:break-word;overflow-wrap:anywhere;max-width:560px;">${bio}</td></tr>`
        : "";

      return `
<table cellpadding="0" cellspacing="0" border="0" role="presentation" style="font-family:Arial,Helvetica,sans-serif;color:#111;max-width:560px;line-height:1.35;">
  ${contentRows}
  ${footerRow}
</table>`.trim();
    }

    function renderPreview() {
      const html = buildSignatureHtml(false);
      preview.innerHTML = html;
      scheduleResize(20);
    }

    function copyHtmlRich(html) {
      if (navigator.clipboard && window.ClipboardItem) {
        const item = new ClipboardItem({
          "text/html": new Blob([html], { type: "text/html" }),
          "text/plain": new Blob([html.replace(/<[^>]*>/g, " ").replace(/\s+/g, " ").trim()], { type: "text/plain" })
        });
        return navigator.clipboard.write([item]);
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        return navigator.clipboard.writeText(html);
      }
      const ta = document.createElement("textarea");
      ta.value = html;
      document.body.appendChild(ta);
      ta.select();
      const copied = document.execCommand("copy");
      ta.remove();
      if (!copied) throw new Error("copy-failed");
      return Promise.resolve();
    }

    async function copyHtmlTextOnly(html) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(html);
        return;
      }
      const ta = document.createElement("textarea");
      ta.value = html;
      document.body.appendChild(ta);
      ta.select();
      const copied = document.execCommand("copy");
      ta.remove();
      if (!copied) throw new Error("copy-failed");
    }

    function setCopyStatus(message, isError = false) {
      copyStatus.textContent = message;
      copyStatus.style.color = isError ? "var(--danger)" : "var(--muted)";
      scheduleResize(10);
    }

    function markManualCopyFallback() {
      preview.classList.add("manual-copy-target");
      preview.focus();
      scheduleResize(10);
      setTimeout(() => {
        preview.classList.remove("manual-copy-target");
        scheduleResize(10);
      }, 1200);
    }

    async function handleCopyAction(buttonId, action) {
      const button = document.getElementById(buttonId);
      const originalText = button.textContent;
      try {
        await action();
        button.textContent = "Copied ✓";
        setCopyStatus("Copied. Paste into your email signature editor.");
      } catch {
        setCopyStatus("Copy failed — try Select + Copy.", true);
        markManualCopyFallback();
      }
      scheduleResize(10);
      setTimeout(() => {
        button.textContent = originalText;
        scheduleResize(10);
      }, 1500);
    }
    function applyPawPreset() {
      el.imageType.value = "Logo";
      el.imageUrl.value = PAW_DEFAULT_IMAGE_URL;
      el.imageShape.value = "Rounded square";
      el.imageLayout.value = "Side-by-side (image left)";
      setAccent("#2f6fed");
    }

    el.imageType.addEventListener("change", () => {
      renderPreview();
      scheduleResize(30);
    });

    function setAccent(color) {
      state.accent = color;
      document.documentElement.style.setProperty("--accent", color);
      el.accentCustom.value = color;
      document.querySelectorAll(".swatch").forEach((node) => {
        node.classList.toggle("active", node.dataset.color.toLowerCase() === color.toLowerCase());
      });
      renderPreview();
    }

    function initSwatches() {
      const container = document.getElementById("swatches");
      swatches.forEach((c) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "swatch";
        b.dataset.color = c;
        b.style.background = c;
        b.title = `Accent ${c}`;
        b.addEventListener("click", () => setAccent(c));
        container.appendChild(b);
      });
      setAccent(state.accent);
    }

    function openPrivacyModal(open) {
      const modal = document.getElementById("privacyModal");
      modal.classList.toggle("open", open);
      modal.setAttribute("aria-hidden", open ? "false" : "true");
      scheduleResize();
    }

    el.style.addEventListener("change", () => {
      if (el.style.value === "paw") {
        applyPawPreset();
      } else if (el.imageUrl.value.trim() === PAW_DEFAULT_IMAGE_URL) {
        el.imageUrl.value = "";
      }
      renderPreview();
    });

    el.accentCustom.addEventListener("input", () => setAccent(el.accentCustom.value));

    document.getElementById("learnWhy").addEventListener("click", () => openPrivacyModal(true));
    document.getElementById("closeModal").addEventListener("click", () => openPrivacyModal(false));
    document.getElementById("privacyModal").addEventListener("click", (evt) => {
      if (evt.target.id === "privacyModal") openPrivacyModal(false);
    });

    document.getElementById("copyPaste").addEventListener("click", () => {
      handleCopyAction("copyPaste", () => copyHtmlRich(buildSignatureHtml(false)));
    });
    document.getElementById("copyGmail").addEventListener("click", () => {
      handleCopyAction("copyGmail", () => copyHtmlRich(buildSignatureHtml(true)));
    });
    document.getElementById("copyHtml").addEventListener("click", () => {
      handleCopyAction("copyHtml", () => copyHtmlTextOnly(buildSignatureHtml(false)));
    });

    const accordionIds = ["contactSection", "socialSection", "imageSection", "taglineSection"];
    accordionIds.forEach((id) => {
      document.getElementById(id).addEventListener("toggle", (evt) => {
        if (evt.target.open) {
          accordionIds.forEach((otherId) => {
            if (otherId !== id) document.getElementById(otherId).open = false;
          });
        }
        scheduleResize(30);
      });
    });

    ["copyHelp"].forEach((id) => {
      document.getElementById(id).addEventListener("toggle", () => scheduleResize(30));
    });

    document.querySelectorAll("input, select, textarea").forEach((node) => {
      const handler = () => {
        renderPreview();
        scheduleResize(50);
      };
      node.addEventListener("input", handler);
      node.addEventListener("change", handler);
    });

    if (mobileLayoutMq.addEventListener) {
      mobileLayoutMq.addEventListener("change", placePreviewPanel);
    } else {
      mobileLayoutMq.addListener(placePreviewPanel);
    }

    placePreviewPanel();
    initSwatches();
    renderPreview();
    scheduleResize();
    setTimeout(() => scheduleResize(), 200);
    setTimeout(() => scheduleResize(), 800);
  </script>
</body>
</html>
