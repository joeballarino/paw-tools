<!doctype html>
<html lang="en">
<head>
  <!--
    PAW Embed Guard (required):
    These tool pages are built for Circle embedding.
    If someone opens this page directly (not in an iframe), redirect to proagentworks.com.
    Keep this lightweight; no dependencies.
  -->
  <script>
    (function () {
      try {
        if (window.top === window.self) {
          window.location.replace("https://proagentworks.com");
        }
      } catch (e) {
        // If cross-origin framing prevents access to window.top, fail closed.
        window.location.replace("https://proagentworks.com");
      }
    })();
  </script>

  <script>
    // PAW Embed Mode Guard
    // -------------------
    // Circle provides the outer card. The embedded tool must render "flat".
    // We rely on paw-ui.css rules that activate when html[data-embed="1"] is present.
    // tool-shell.js will set this when initialized, but this UI scaffold does not
    // depend on shell init yet, so we set it here as well.
    (function(){
      try{
        var params = new URLSearchParams(window.location.search);
        var isEmbedParam = params.get('embed') === '1';
        var isInIframe = (function(){ try{ return window.self !== window.top; } catch(e){ return true; } })();
        if(isEmbedParam || isInIframe){
          document.documentElement.setAttribute('data-embed','1');
        }
      }catch(e){}
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Presence</title>

  <!-- Shared PAW styles (do not fork) -->
  <link rel="stylesheet" href="./paw-ui.css">

  <!--
    ProAgent Works — Presence (Circle-embedded tool page)
    ----------------------------------------------------
    PURPOSE (v1):
    - Intent-aware content studio for identity, authority, and local expertise.
    - Generates public-facing content structured for its intended use/destination.
    - Provides an "escape hatch" for real-world edge cases (Something else / Custom destination).

    IMPORTANT PRODUCT RULES (LOCKED):
    - Circle owns the tool title. This embedded page MUST NOT render its own title.
    - Nothing is saved automatically. (This v1 UI does not implement Save; it can suggest it in copy.)
    - My Brand influence is contextual and applied by the Worker when relevant.
    - This page contains NO AI prompting logic. All "secret sauce" lives in the Worker.

    IMPLEMENTATION NOTES:
    - Uses tool-shell.js for consistent chat + deliverable modal behavior.
    - Uses deliverable mode (Copy / Revise) because Presence outputs are typically paste-ready.
    - Sends structured preferences to the Worker:
        presence_content_type, presence_destination, presence_custom_destination, presence_constraints

    FUTURE PHASES (not implemented here):
    - Optional "Save to My Stuff" actions once Worker endpoints exist for Presence items.
    - Template-like reusable content blocks (My Brand / Presence patterns).
  -->

  <style>
    /* ==========================================================
       PAW Presence — Scoped UI styles (v1)
       ----------------------------------------------------------
       Goal:
       - Calm, structured, intent-aware controls without turning into a form.
       - Mobile-first behavior: stack cleanly; no horizontal scroll.
       - Scoped to Presence only (do not modify shared paw-ui.css).
       ========================================================== */

    body.paw-presence .presence-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:12px 14px 12px;background:transparent;
    }

    body.paw-presence .presence-row{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      gap:12px;
    }

    body.paw-presence .presence-block{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 240px;
      flex: 1 1 240px;
    }

    body.paw-presence .presence-label{
      font-size:12px;
      font-weight:900;
      color:rgba(15,23,42,.72);
      letter-spacing:-0.01em;
    }

    body.paw-presence .presence-select,
    body.paw-presence .presence-input{
      height:38px;
      width:100%;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.14);
      background:rgba(255,255,255,.92);
      padding:8px 10px;
      font-size:14px;
      font-weight:750;
      color:rgba(15,23,42,.92);
      outline:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    }

    body.paw-presence .presence-select:focus,
    body.paw-presence .presence-input:focus{
      border-color:rgba(5,195,249,.70);
      box-shadow:0 0 0 4px rgba(5,195,249,.14);
      background:#fff;
    }

    body.paw-presence .presence-hint{
      font-size:12px;
      font-weight:700;
      color:rgba(15,23,42,.60);
      line-height:1.25;
      margin-top:2px;
    }

    body.paw-presence .presence-mini{
      padding:10px 14px 12px;background:transparent;
    }

    body.paw-presence .presence-mini textarea{
      width:100%;
      min-height:64px;
      max-height:220px;
      resize:none;
      overflow-y:auto;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.14);
      background:rgba(255,255,255,.92);
      padding:12px 12px;
      font-size:14px;
      font-weight:650;
      line-height:1.35;
      color:rgba(15,23,42,.92);
      outline:none;
    }
    body.paw-presence .presence-mini textarea:focus{
      border-color:rgba(5,195,249,.70);
      box-shadow:0 0 0 4px rgba(5,195,249,.14);
      background:#fff;
    }

    body.paw-presence .presence-mini .mini-title{
      font-size:12px;
      font-weight:900;
      color:rgba(15,23,42,.72);
      letter-spacing:-0.01em;
      margin:0 0 6px 0;
    }

    /* Hide the message area when empty so the composer sits closer to the intent controls (calmer feel) */
    body.paw-presence #messages:empty{
      display:none;
    }

    /* Mobile: stack blocks cleanly */
    @media (max-width: 560px){
      body.paw-presence .presence-controls{ padding:10px 12px 12px; }
      body.paw-presence .presence-row{ flex-direction:column; align-items:stretch; }
      body.paw-presence .presence-block{ min-width:0; width:100%; }
    }
  </style>
</head>

<body class="paw-presence">
  <div class="app">
    <div class="frame">
      <div class="panel">

        <div class="panel-topbar">
          <div class="topbar-row0">
            <div class="tool-head">
              <button id="pawMyStuffBtn" class="paw-mystuff-btn paw-works-btn" type="button" aria-label="Work context">
                <img class="works-paw" src="https://paw-tools.pages.dev/paw.png" alt="" aria-hidden="true">
                <span class="works-label">Work</span>
                <span class="works-chevron" aria-hidden="true">▾</span>
              </button>
            </div>

            

            <div class="topbar-right">
  

              <div class="utility-pair paw-seg" role="group" aria-label="Tool utilities">
                <button id="reset" class="util-btn paw-seg__btn" type="button">Reset</button>
                <button id="tips" class="util-btn paw-seg__btn" type="button">Tips &amp; How To</button>
              </div>
            </div>
          </div>

          <!-- Presence intent controls -->
          <div class="presence-controls" aria-label="Presence intent controls">
            <div class="presence-row" aria-label="Presence primary selectors">

              <div class="presence-block">
                <div class="presence-label">What are you creating?</div>
                <select id="contentType" class="presence-select" aria-label="Content type">
                  <option value="" selected>Choose…</option>
                  <option value="bio">Bio / About Me</option>
                  <option value="authority">Authority content (article / blog)</option>
                  <option value="local">Local content</option>
                  <option value="social">Social content</option>
                  <option value="guide">Guide-related content</option>
                  <option value="other">Something else (describe it)</option>
                </select>
</div>

              <div class="presence-block" id="destBlock" style="display:none;">
                <div class="presence-label">Where will this be used?</div>
                <select id="destination" class="presence-select" aria-label="Destination">
                  <option value="" selected>Choose…</option>
                </select>
</div>

              <div class="presence-block" id="customDestBlock" style="display:none;">
                <div class="presence-label">Custom destination</div>
                <input id="customDest" class="presence-input" type="text"
                  placeholder="e.g., Conference app profile" autocomplete="off" />
</div>

              <div class="presence-block" id="constraintsBlock" style="display:none;">
                <div class="presence-label">Any constraints?</div>
                <input id="constraints" class="presence-input" type="text"
                  placeholder="e.g., Max 300 characters" autocomplete="off" />
</div>

            </div>
          </div>

          <!-- Optional context (light, not required) -->
          <div class="presence-mini" aria-label="Presence optional context">
            <div class="mini-title">Anything PAW should know? (optional)</div>
            <textarea id="context" placeholder="Market, audience, bullets, or a rough draft…"></textarea>
          </div>

        </div>

        <!-- Messages (shell-managed) -->
        <div id="messages" class="messages" aria-live="polite"></div>

        <!-- Composer -->
        <div class="composer">
          <div class="composer-main">
            <div class="composer-help">Tell PAW what you want to create. Paste notes or an existing draft if you have one.</div>
            <textarea id="prompt" class="prompt"
              placeholder="Example: Write 3 posts for first-time buyers in [CITY]"></textarea>
          </div>

          <button id="send" class="send" aria-label="Generate" type="button">
            <img src="https://paw-tools.pages.dev/paw.png" class="send-icon" alt="">
          </button>
        </div>

      </div>
    </div>
  </div>

  <script src="/tool-shell.js"></script>
  <script>
    const API_ENDPOINT = "https://paw-api.joe-b40.workers.dev";

    // PAW Tool Shell init (required for consistent My Works mode across tools)
    try {
      if (window.PAWToolShell && window.PAWToolShell.init) {
        window.PAWToolShell.init({
          apiEndpoint: API_ENDPOINT,
          toolId: "presence"
        });
      }
    } catch (_) {}
  </script>

  <!-- ==========================================================
       PAW Iframe Height Reporter (v1.1 - loop-safe, STANDARD)
       ----------------------------------------------------------
       PURPOSE:
       - Reports the tool's visible panel height to the Circle parent page.
       - Enables "grow-to-fit" embeds with no internal scrollbars.
       - STANDARDIZED across all tools so Work: Ready behaves identically everywhere.
       CONTRACT:
       - Sends: { type: "paw_iframe_height_request_v1", height: <number> }
       ========================================================== -->
  <script>
    (function () {
      if (window.__PAW_HEIGHT_REPORTER_V11__) return;
      window.__PAW_HEIGHT_REPORTER_V11__ = true;

      var lastSent = 0;
      var rafPending = false;
      var IGNORE_DELTA_PX = 8;

      function px(n){ n = Number(n); return isFinite(n) ? n : 0; }

      function measureContentHeight() {
        try {
          // Prefer the visible "panel" container (consistent across PAW tools)
          var panel = document.querySelector(".panel");
          if (panel && panel.getBoundingClientRect) {
            var r = panel.getBoundingClientRect();
            return Math.ceil(px(r.height));
          }

          // Fallback: sum key areas if present
          var topbar = document.querySelector(".panel-topbar");
          var messages = document.getElementById("messages") || document.querySelector(".messages");
          var composer = document.querySelector(".composer");

          var h = 0;
          if (topbar && topbar.getBoundingClientRect) h += px(topbar.getBoundingClientRect().height);
          if (messages && messages.getBoundingClientRect) h += px(messages.getBoundingClientRect().height);
          if (composer && composer.getBoundingClientRect) h += px(composer.getBoundingClientRect().height);

          if (h > 0) return Math.ceil(h);

          // Last-resort fallback (for simpler layouts)
          var d = document.documentElement;
          return Math.ceil(Math.max(px(d.scrollHeight), px(d.offsetHeight)));
        } catch (_) {
          return 0;
        }
      }

      function postHeight(force) {
        var h = measureContentHeight();
        if (!h) return;

        if (!force && Math.abs(h - lastSent) < IGNORE_DELTA_PX) return;
        lastSent = h;

        try {
          window.parent.postMessage(
            { type: "paw_iframe_height_request_v1", height: h },
            "*"
          );
        } catch (_) {}
      }

      function schedule(force) {
        if (rafPending) return;
        rafPending = true;
        requestAnimationFrame(function () {
          rafPending = false;
          postHeight(!!force);
        });
      }

      // Initial + settle passes (fonts/images/layout settle)
      schedule(true);
      setTimeout(function(){ schedule(true); }, 120);
      setTimeout(function(){ schedule(true); }, 400);

      // DOM changes (chat streaming, Work mode swap, modal open/close, etc.)
      try {
        var mo = new MutationObserver(function(){ schedule(false); });
        mo.observe(document.body, { childList:true, subtree:true, characterData:true });
      } catch (_) {}

      // Images loading after insertion
      document.addEventListener("load", function(e){
        try { if (e.target && e.target.tagName === "IMG") schedule(false); } catch (_) {}
      }, true);

      // Resize/orientation/keyboard changes
      window.addEventListener("resize", function(){ schedule(true); });
    })();
  </script>

</body>
</html>
