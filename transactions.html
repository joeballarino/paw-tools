<!doctype html>
<html lang="en">
<head>
  <!--
    PAW Embed Guard (required):
    These tool pages are built for Circle embedding.
    If someone opens this page directly (not in an iframe), redirect to proagentworks.com.
    Keep this lightweight; no dependencies.
  -->
  <script>
    (function () {
      try {
        if (window.top === window.self) {
          window.location.replace("https://proagentworks.com");
        }
      } catch (e) {
        // If cross-origin framing prevents access to window.top, fail closed.
        window.location.replace("https://proagentworks.com");
      }
    })();
  </script>

  <script>
    // PAW Embed Mode Guard
    // -------------------
    // Circle provides the outer card. The embedded tool must render "flat".
    // We rely on paw-ui.css rules that activate when html[data-embed="1"] is present.
    // tool-shell.js will set this when initialized, but Contracts UI should not
    // depend on shell init (or any later script) to render correctly.
    (function(){
      try{
        var params = new URLSearchParams(window.location.search);
        var isEmbedParam = params.get('embed') === '1';
        var isInIframe = (function(){ try{ return window.self !== window.top; } catch(e){ return true; } })();
        if(isEmbedParam || isInIframe){
          document.documentElement.setAttribute('data-embed','1');
        }
      }catch(e){}
    })();
  </script>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contracts</title>

  <!--
    NOTE: paw-ui.css is SHARED across tools.

    DOUBLE CONTAINER FIX (important):
    - Embed mode styling is activated by tool-shell.js (sets html[data-embed="1"]).
    - If this page forgets to include tool-shell.js, the panel gets its own border/shadow inside Circle,
      which looks like a “double container”. Keep tool-shell.js included for consistent embed rendering.
    Keep header markup consistent:
    panel-topbar > topbar-row0 > tool-subtitle + topbar-right (utility-pair).
    Changing shared classes affects multiple tools.
  -->
  <link rel="stylesheet" href="./paw-ui.css">

  <style>
    /* ==========================================================
       PAW — Contracts (Circle-embedded tool page)
       ----------------------------------------------------------
       DESIGN GOALS (v1):
       - Chat-first (works with or without a document)
       - Optional contract upload (PDF) for more precise analysis
       - Contract review selector (Blank / Draft / Executed) sets tone and output style
       - Scanned PDFs are NOT supported (we reject and ask for a digital PDF)

       IMPORTANT PRODUCT RULES:
       - No AI logic lives here. All "secret sauce" prompting is in the Worker.
       - Do NOT store uploaded contracts in localStorage.
         We only store chat history + contract type selection as a local draft (optional).
       ========================================================== */

    body.paw-contracts .contracts-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:10px 14px 12px;
      border-bottom:none; /* removed: line between upload + chat */
      background:transparent;
    }


    /* Contracts-only: When there are no messages yet, collapse the empty message area
       so the composer (input box) sits directly under the upload controls. */
    body.paw-contracts #messages:empty{
      display:none;
    }

    body.paw-contracts .contracts-row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:12px;
    }

    body.paw-contracts .contracts-row--meta{
      min-height:18px; /* reserved blank row for file details */
    }


    body.paw-contracts .contracts-block{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 220px;
    }

    body.paw-contracts .contracts-label{
      font-size:12px;
      font-weight:800;
      color:rgba(15,23,42,.72);
      letter-spacing:-0.01em;
    }

    /* Stage segmented control (scoped to Contracts only) */
    body.paw-contracts .stage-seg,
    body.paw-contracts .type-seg{
      display:flex;
      align-items:center;
      gap:0;
      border:1px solid rgba(15,23,42,.12);
      background:rgba(255,255,255,.86);
      border-radius:999px;
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      width: fit-content;
    }
    body.paw-contracts .stage-btn,
    body.paw-contracts .type-btn{
      height:32px;
      padding:0 14px;
      border:0;
      background:transparent;
      color:rgba(15,23,42,.78);
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: background .15s ease, color .15s ease;
    }
    body.paw-contracts .stage-btn:hover{ background:rgba(15,23,42,.05); }
    body.paw-contracts .stage-btn + .stage-btn{ border-left:1px solid rgba(15,23,42,.10); }
    body.paw-contracts .type-btn + .type-btn{ border-left:1px solid rgba(15,23,42,.10); }
    body.paw-contracts .stage-btn.primary,
    body.paw-contracts .type-btn.primary{
      background: rgba(5,195,249,.18);
      color: rgba(15,23,42,.92);
    }

    /* Upload row */
    body.paw-contracts .upload-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    body.paw-contracts .file-pill{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:10px;
      height:34px;
      padding:0 12px;
      border-radius:999px;
      border:1px solid var(--field-border);
      background:rgba(255,255,255,.92);
      font-weight:800;
      font-size:13px;
      color:var(--text-strong);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    }
    body.paw-contracts .file-pill input[type="file"]{
      position:absolute;
      inset:0;
      opacity:0;
      cursor:pointer;
      width:100%;
      height:100%;
    }
    body.paw-contracts .file-name{
      font-size:13px;
      font-weight:750;
      color:rgba(15,23,42,.82);
      max-width: 360px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    body.paw-contracts .file-sub{
      font-size:12px;
      color:rgba(15,23,42,.60);
      line-height:1.2;
    }

    body.paw-contracts .file-hint{
      font-size:12px;
      color:rgba(15,23,42,.65);
      white-space:nowrap;
    }

    body.paw-contracts .mini-btn{
      height:34px;
      padding:0 12px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.14);
      background:rgba(255,255,255,.92);
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease, transform .06s ease;
    }
    body.paw-contracts .mini-btn:hover{ background:#fff; border-color: rgba(15,23,42,.18); }
    body.paw-contracts .mini-btn:active{ transform: translateY(1px); }
    body.paw-contracts .mini-btn.primary{
      border-color: rgba(5,195,249,.55);
      background: rgba(5,195,249,.16);
      color: rgba(15,23,42,.92);
    }

    /* Mobile: stack nicely */
    @media (max-width: 560px){
      body.paw-contracts .contracts-controls{
        flex-direction:column;
        align-items:stretch;
      }
      body.paw-contracts .contracts-action-row{
        flex-direction:column;
        align-items:stretch;
        gap:14px;
      }
      body.paw-contracts .contracts-block{ min-width: 0; width:100%; }
      body.paw-contracts .stage-seg,
    body.paw-contracts .type-seg{ width:100%; }
      body.paw-contracts .stage-btn,
    body.paw-contracts .type-btn{ flex:1 1 0; height:40px; font-size:14px; }
      body.paw-contracts .file-pill{ width:100%; justify-content:center; height:48px; font-size:14px; }
      body.paw-contracts #analyzeBtn{ width:100%; height:48px; min-height:48px; font-size:14px; margin-top:2px; }
      body.paw-contracts .file-name{ max-width: 100%; }

    }

    /* Contracts action row */
body.paw-contracts .contracts-action-row{
  gap:10px;
  align-items:center;
}

/* Disabled segmented buttons (Contracts-only) */
body.paw-contracts .type-btn:disabled{
  opacity:.45;
  cursor:not-allowed;
  pointer-events:none;
}

/* Analyze button (Contracts-specific) */
body.paw-contracts #analyzeBtn[disabled]{
  opacity:.45;
  cursor:not-allowed;
  pointer-events:none;
}

</style>
</head>

<body class="paw-contracts">
  <div class="app">
    <div class="frame">
      <div class="panel">

        <div class="panel-topbar">
          <div class="topbar-row0">
            <div class="tool-head">
              <button id="pawMyStuffBtn" class="paw-mystuff-btn paw-works-btn" type="button" aria-label="Work context">
                <img class="works-paw" src="https://paw-tools.pages.dev/paw.png" alt="" aria-hidden="true">
                <span class="works-label">Work</span>
                <span class="works-chevron" aria-hidden="true">▾</span>
              </button>
            </div>

            

            <div class="topbar-right">
  

              <div class="utility-pair paw-seg" role="group" aria-label="Tool utilities">
                <button id="reset" class="util-btn paw-seg__btn" type="button">Reset</button>
                <button id="tips" class="util-btn paw-seg__btn" type="button">Tips &amp; How To</button>
              </div>
            </div>
          </div>

                    <!-- Controls: Contract Review + Upload (optional) -->
          <div class="contracts-controls" aria-label="Contracts controls">

            <!-- Row A+B: Action row (Choose PDF + Review state + Analyze) -->
<div class="contracts-row contracts-action-row" aria-label="Contracts action row">
  <div class="file-pill" title="Choose a PDF file">
    <label class="file-pill__label" for="file">Choose PDF…</label>
    <input id="file" type="file" accept="application/pdf" />
  </div>

  <div id="reviewSeg" class="type-seg" role="group" aria-label="Contract review" style="display:none">
    <button class="type-btn" type="button" data-review="blank" aria-pressed="false" disabled>Blank</button>
    <button class="type-btn" type="button" data-review="draft" aria-pressed="false" disabled>Draft</button>
    <button class="type-btn" type="button" data-review="executed" aria-pressed="false" disabled>Executed</button>
  </div>

  <button id="analyzeBtn" class="type-btn primary analyze-btn" type="button" disabled style="display:none">Analyze</button>
</div>

<!-- Row C: Reserved space for upload details (populates after file selection) -->

            <div id="fileMetaRow" class="contracts-row contracts-row--meta" aria-label="Upload details row">
              <div id="fileName" class="file-name" aria-live="polite"></div>
            </div>

          </div>

        <div id="messages" class="messages" aria-live="polite"></div>

        <div class="composer">
          
          <div class="composer-main">
            <div class="composer-help">Ask about deadlines, contingencies, responsibilities, or risks.</div>
            <textarea id="input" placeholder="Example: Summarize deadlines and who owes what"></textarea>
          </div>
          <button id="send" class="send" aria-label="Send" type="button">
            <img src="https://paw-tools.pages.dev/paw.png" class="send-icon" alt="">
          </button>
        </div>

      </div>
    </div>
  </div>

  <script src="/tool-shell.js"></script>
  <script>
    const API_ENDPOINT = "https://paw-api.joe-b40.workers.dev";

    // PAW Tool Shell init (required for consistent My Works mode across tools)
    try {
      if (window.PAWToolShell && window.PAWToolShell.init) {
        window.PAWToolShell.init({
          apiEndpoint: API_ENDPOINT,
          toolId: "transactions"
        });
      }
    } catch (_) {}
  </script>

  <!-- ==========================================================
       PAW Iframe Height Reporter (v1.1 - loop-safe, STANDARD)
       ----------------------------------------------------------
       PURPOSE:
       - Reports the tool's visible panel height to the Circle parent page.
       - Enables "grow-to-fit" embeds with no internal scrollbars.
       - STANDARDIZED across all tools so Work: Ready behaves identically everywhere.
       CONTRACT:
       - Sends: { type: "paw_iframe_height_request_v1", height: <number> }
       ========================================================== -->
  <script>
    (function () {
      if (window.__PAW_HEIGHT_REPORTER_V11__) return;
      window.__PAW_HEIGHT_REPORTER_V11__ = true;

      var lastSent = 0;
      var rafPending = false;
      var IGNORE_DELTA_PX = 8;

      function px(n){ n = Number(n); return isFinite(n) ? n : 0; }

      function measureContentHeight() {
        try {
          // Prefer the visible "panel" container (consistent across PAW tools)
          var panel = document.querySelector(".panel");
          if (panel && panel.getBoundingClientRect) {
            var r = panel.getBoundingClientRect();
            return Math.ceil(px(r.height));
          }

          // Fallback: sum key areas if present
          var topbar = document.querySelector(".panel-topbar");
          var messages = document.getElementById("messages") || document.querySelector(".messages");
          var composer = document.querySelector(".composer");

          var h = 0;
          if (topbar && topbar.getBoundingClientRect) h += px(topbar.getBoundingClientRect().height);
          if (messages && messages.getBoundingClientRect) h += px(messages.getBoundingClientRect().height);
          if (composer && composer.getBoundingClientRect) h += px(composer.getBoundingClientRect().height);

          if (h > 0) return Math.ceil(h);

          // Last-resort fallback (for simpler layouts)
          var d = document.documentElement;
          return Math.ceil(Math.max(px(d.scrollHeight), px(d.offsetHeight)));
        } catch (_) {
          return 0;
        }
      }

      function postHeight(force) {
        var h = measureContentHeight();
        if (!h) return;

        if (!force && Math.abs(h - lastSent) < IGNORE_DELTA_PX) return;
        lastSent = h;

        try {
          window.parent.postMessage(
            { type: "paw_iframe_height_request_v1", height: h },
            "*"
          );
        } catch (_) {}
      }

      function schedule(force) {
        if (rafPending) return;
        rafPending = true;
        requestAnimationFrame(function () {
          rafPending = false;
          postHeight(!!force);
        });
      }

      // Initial + settle passes (fonts/images/layout settle)
      schedule(true);
      setTimeout(function(){ schedule(true); }, 120);
      setTimeout(function(){ schedule(true); }, 400);

      // DOM changes (chat streaming, Work mode swap, modal open/close, etc.)
      try {
        var mo = new MutationObserver(function(){ schedule(false); });
        mo.observe(document.body, { childList:true, subtree:true, characterData:true });
      } catch (_) {}

      // Images loading after insertion
      document.addEventListener("load", function(e){
        try { if (e.target && e.target.tagName === "IMG") schedule(false); } catch (_) {}
      }, true);

      // Resize/orientation/keyboard changes
      window.addEventListener("resize", function(){ schedule(true); });
    })();
  </script>

</body>
</html>
