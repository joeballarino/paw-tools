<!doctype html>
<html lang="en">
<head>
<!--
    PAW Embed Guard (required):
    These tool pages are built for Circle embedding.
    If someone opens this page directly (not in an iframe), redirect to proagentworks.com.
    Keep this lightweight; no dependencies.
  -->
<script>
    (function () {
      try {
        if (window.top === window.self) {
          window.location.replace("https://proagentworks.com");
        }
      } catch (e) {
        // If cross-origin framing prevents access to window.top, fail closed.
        window.location.replace("https://proagentworks.com");
      }
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Connect</title>
  <link rel="stylesheet" href="./paw-ui.css">

  <script>
    // PAW Embed Mode Guard
    // -------------------
    // Circle provides the outer card. The embedded tool must render "flat".
    // We rely on paw-ui.css rules that activate when html[data-embed="1"] is present.
    // tool-shell.js will set this when initialized, but this UI scaffold does not
    // depend on shell init yet, so we set it here as well.
    (function(){
      try{
        var params = new URLSearchParams(window.location.search);
        var isEmbedParam = params.get('embed') === '1';
        var isInIframe = (function(){ try{ return window.self !== window.top; } catch(e){ return true; } })();
        if(isEmbedParam || isInIframe){
          document.documentElement.setAttribute('data-embed','1');
        }
      }catch(e){}
    })();
  </script>

  <!--
    ProAgent Works — Connect (EMBED TOOL)
    ------------------------------------
    PURPOSE (v1 UI scaffold):
    - This file is the Circle-embedded UI for the Connect communication tool.
    - In this step we are intentionally shipping the UI skeleton first so it can be reviewed
      inside Circle before wiring to the Cloudflare Worker.

    IMPORTANT PRODUCT RULES (locked for PAW tools):
    - Circle owns the tool title. The embedded tool MUST NOT render its own title.
    - The panel top bar (.topbar-row0) contains:
        subtitle/description (left) + Reset/Tips buttons (right)
      ...and NOTHING ELSE.
    - Embed mode:
        tool-shell.js sets html[data-embed="1"] when ?embed=1 is present or when inside an iframe.
        paw-ui.css flattens the panel in embed mode so Circle provides the outer card.

    WIRING NOTE:
    - NO AI logic lives here. All model prompting + output generation will be done by the Worker.
    - This UI currently provides:
        * button-state controls (Type / Send via / Use as)
        * message/context textarea + Generate button
        * message feed area (same shell structure as other tools)
      The Generate button is stubbed for now (it adds a local placeholder message).

    FUTURE ASSISTANTS:
    - When wiring begins, reuse the proven patterns from listing.html and ask.html:
        * shell state (tool-shell.js)
        * reset contract (full reset clears UI + deletes draft)
        * resume modal + autosave (if we decide to keep it consistent with Listing)
  -->
  <style>
    /* ==========================================================
       PAW Connect — Segmented Controls (v2)
       ----------------------------------------------------------
       GOAL:
       - Make each binary choice feel like ONE connected control
         (Choose one / Send via / Use as)
       - Desktop: label inline with segmented control
       - Mobile: label stacked above full-width segmented control
       - Scoped to Connect only (no shared CSS changes yet)

       NOTE FOR FUTURE ASSISTANTS:
       - If we decide to standardize this across tools, migrate these
         styles into paw-ui.css as a reusable component (e.g. .paw-seg2).
       ========================================================== */

    .connect-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:12px 14px 12px;
      border-bottom:1px solid var(--border-soft);
    }

    .connect-row{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:nowrap;
    }

    .connect-block{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .connect-label{
      font-size:12px;
      font-weight:800;
      color:rgba(15,23,42,.72);
      letter-spacing:-0.01em;
      margin-right:2px;
      white-space:nowrap;
    }

    /* Segmented pill container */
    .connect-seg{
      display:flex;
      align-items:center;
      gap:0;
    }

    .connect-seg.paw-seg {
      display: inline-flex;
      width: auto;
      flex: 0 0 auto;
    }

    .connect-seg-btn{
      flex:0 0 auto;
      min-width:0;
      height:32px;
      padding:0 14px;
      white-space:nowrap;
    }

    .connect-seg-btn.paw-seg__btn { flex: 0 0 auto !important; }

    .connect-controls .connect-seg.paw-seg .paw-seg__btn {
      padding: 0 10px !important;
      font-size: 12px !important;
      height: 30px;
    }

    @media (max-width: 1040px){
      .connect-row{
        flex-wrap:wrap;
      }
    }

    /* Mobile: stack each block, full-width segmented control */
    @media (max-width: 560px){
      .connect-controls{ padding:10px 12px 12px; }
      .connect-row{
        flex-direction:column;
        align-items:stretch;
        gap:12px;
      }
      .connect-block{
        flex-direction:column;
        align-items:flex-start;
        gap:6px;
        width:100%;
      }
      .connect-seg{ width:100%; }
      .connect-seg-btn{ flex:1 1 0; }
    }
</style>
</head>

<body>
  <div class="app">
    <div class="frame">
      <div class="panel">

        <div class="panel-topbar">
          <div class="topbar-row0">
            <div class="tool-head">
              <button id="pawMyStuffBtn" class="paw-mystuff-btn paw-works-btn" type="button" aria-label="Work context">
                <img class="works-paw" src="https://paw-tools.pages.dev/paw.png" alt="" aria-hidden="true">
                <span class="works-label">Work</span>
                <span class="works-chevron" aria-hidden="true">▾</span>
              </button>
            </div>

            

            <div class="topbar-right">
  

              <div class="utility-pair paw-seg" role="group" aria-label="Tool utilities">
                <button id="reset" class="util-btn paw-seg__btn" type="button">Reset</button>
                <button id="tips" class="util-btn paw-seg__btn" type="button">Tips &amp; How To</button>
              </div>
            </div>
          </div>

          <!-- Settings (connected segmented controls) -->
<div class="connect-controls" aria-label="Connect settings">
  <div class="connect-row" aria-label="Connect settings">

    <div class="connect-block">
      <div class="connect-label">Choose one</div>
      <div class="connect-seg paw-seg" role="group" aria-label="Type">
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="type" data-value="first_contact">First contact</button>
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="type" data-value="continue">Continue</button>
      </div>
    </div>

    <div class="connect-block">
      <div class="connect-label">Send via</div>
      <div class="connect-seg paw-seg" role="group" aria-label="Send via">
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="channel" data-value="email">Email</button>
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="channel" data-value="text">Text</button>
      </div>
    </div>

    <div class="connect-block">
      <div class="connect-label">Use as</div>
      <div class="connect-seg paw-seg" role="group" aria-label="Use as">
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="use" data-value="once">Send once</button>
        <button class="connect-seg-btn paw-seg__btn" type="button" data-group="use" data-value="template">Template</button>
      </div>
    </div>

  </div>
</div>
<!-- Message feed (same structure as Listing/Ask so tool-shell can manage it later) -->
        <div id="messages" class="messages" aria-live="polite"></div>

        <!-- Composer -->
        <div class="composer">
          
          <div class="composer-main">
            <div class="composer-help">Paste their message + tell PAW what you want to happen.</div>
            <textarea id="prompt" class="prompt" placeholder="Example: Reply to “we’re waiting” and book a quick call"></textarea>
          </div>

          <button id="send" class="send" aria-label="Generate message" type="button">
            <img src="https://paw-tools.pages.dev/paw.png" class="send-icon" alt="">
          </button>
        </div>

      </div>
    </div>
  </div>

  <script src="https://paw-tools.pages.dev/tool-shell.js"></script>
  <script>
    // PAW Tool Shell init (required for consistent My Works mode across tools)
    try {
      if (window.PAWToolShell && window.PAWToolShell.init) {
        window.PAWToolShell.init({
          apiEndpoint: "", // Placeholder until this tool uses the Worker
          toolId: "connect"
        });
      }
    } catch (_) {}
  </script>

  <!-- ==========================================================
       PAW Iframe Height Reporter (v1.1 - loop-safe, STANDARD)
       ----------------------------------------------------------
       PURPOSE:
       - Reports the tool's visible panel height to the Circle parent page.
       - Enables "grow-to-fit" embeds with no internal scrollbars.
       - STANDARDIZED across all tools so Work: Ready behaves identically everywhere.
       CONTRACT:
       - Sends: { type: "paw_iframe_height_request_v1", height: <number> }
       ========================================================== -->
  <script>
    (function () {
      if (window.__PAW_HEIGHT_REPORTER_V11__) return;
      window.__PAW_HEIGHT_REPORTER_V11__ = true;

      var lastSent = 0;
      var rafPending = false;
      var IGNORE_DELTA_PX = 8;

      function px(n){ n = Number(n); return isFinite(n) ? n : 0; }

      function measureContentHeight() {
        try {
          // Prefer the visible "panel" container (consistent across PAW tools)
          var panel = document.querySelector(".panel");
          if (panel && panel.getBoundingClientRect) {
            var r = panel.getBoundingClientRect();
            return Math.ceil(px(r.height));
          }

          // Fallback: sum key areas if present
          var topbar = document.querySelector(".panel-topbar");
          var messages = document.getElementById("messages") || document.querySelector(".messages");
          var composer = document.querySelector(".composer");

          var h = 0;
          if (topbar && topbar.getBoundingClientRect) h += px(topbar.getBoundingClientRect().height);
          if (messages && messages.getBoundingClientRect) h += px(messages.getBoundingClientRect().height);
          if (composer && composer.getBoundingClientRect) h += px(composer.getBoundingClientRect().height);

          if (h > 0) return Math.ceil(h);

          // Last-resort fallback (for simpler layouts)
          var d = document.documentElement;
          return Math.ceil(Math.max(px(d.scrollHeight), px(d.offsetHeight)));
        } catch (_) {
          return 0;
        }
      }

      function postHeight(force) {
        var h = measureContentHeight();
        if (!h) return;

        if (!force && Math.abs(h - lastSent) < IGNORE_DELTA_PX) return;
        lastSent = h;

        try {
          window.parent.postMessage(
            { type: "paw_iframe_height_request_v1", height: h },
            "*"
          );
        } catch (_) {}
      }

      function schedule(force) {
        if (rafPending) return;
        rafPending = true;
        requestAnimationFrame(function () {
          rafPending = false;
          postHeight(!!force);
        });
      }

      // Initial + settle passes (fonts/images/layout settle)
      schedule(true);
      setTimeout(function(){ schedule(true); }, 120);
      setTimeout(function(){ schedule(true); }, 400);

      // DOM changes (chat streaming, Work mode swap, modal open/close, etc.)
      try {
        var mo = new MutationObserver(function(){ schedule(false); });
        mo.observe(document.body, { childList:true, subtree:true, characterData:true });
      } catch (_) {}

      // Images loading after insertion
      document.addEventListener("load", function(e){
        try { if (e.target && e.target.tagName === "IMG") schedule(false); } catch (_) {}
      }, true);

      // Resize/orientation/keyboard changes
      window.addEventListener("resize", function(){ schedule(true); });
    })();
  </script>

</body>
</html>
