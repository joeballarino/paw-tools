<!doctype html>
<html lang="en">
<head>
  <!--
    PAW Embed Guard (required):
    These tool pages are built for Circle embedding.
    If someone opens this page directly (not in an iframe), redirect to proagentworks.com.
    Keep this lightweight; no dependencies.
  -->
  <script>
    (function () {
      try {
        if (window.top === window.self) {
          window.location.replace("https://proagentworks.com");
        }
      } catch (e) {
        // If cross-origin framing prevents access to window.top, fail closed.
        window.location.replace("https://proagentworks.com");
      }
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contracts</title>

  <!--
    NOTE: paw-ui.css is SHARED across tools.
    Keep header markup consistent:
    panel-topbar > topbar-row0 > tool-subtitle + topbar-right (utility-pair).
    Changing shared classes affects multiple tools.
  -->
  <link rel="stylesheet" href="./paw-ui.css">

  <style>
    /* ==========================================================
       PAW — Contracts (Circle-embedded tool page) — UI ONLY (v1)
       ----------------------------------------------------------
       CURRENT SCOPE (LOCKED FOR NOW):
       - This file is the UI scaffold ONLY. It is NOT wired to the Worker yet.
       - No AI logic here. No upload processing here. No API calls here.
       - Goal is to finalize layout + IDs so Worker wiring is easy next.

       LAYOUT REQUIREMENT (requested):
       Row 1: File Stage   (Blank / Draft / Executed) as text buttons side-by-side
       Row 2: File Upload  "Choose PDF…" button, followed by "Digitally generated PDFs only."
       - Analyze button removed (we will analyze on upload once wired)
       ========================================================== */

    body.paw-contracts .contracts-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:10px 14px 12px;
      border-bottom:1px solid var(--border-soft);
      background:transparent;
    }

    body.paw-contracts .contracts-row{
      display:flex;
      align-items:center;
      gap:16px;
      flex-wrap:wrap;
    }

    body.paw-contracts .contracts-label{
      font-size:12px;
      font-weight:800;
      color:rgba(15,23,42,.72);
      letter-spacing:-0.01em;
      white-space:nowrap;
    }

    /* Stage segmented control (scoped to Contracts only) */
    body.paw-contracts .stage-seg{
      display:flex;
      align-items:center;
      gap:0;
      border:1px solid rgba(15,23,42,.12);
      background:rgba(255,255,255,.86);
      border-radius:999px;
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    }
    body.paw-contracts .stage-btn{
      height:32px;
      padding:0 14px;
      border:0;
      background:transparent;
      color:rgba(15,23,42,.78);
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: background .15s ease, color .15s ease;
    }
    body.paw-contracts .stage-btn:hover{ background:rgba(15,23,42,.05); }
    body.paw-contracts .stage-btn + .stage-btn{ border-left:1px solid rgba(15,23,42,.10); }
    body.paw-contracts .stage-btn.primary{
      background: rgba(5,195,249,.18);
      color: rgba(15,23,42,.92);
    }

    /* Upload button pill */
    body.paw-contracts .file-pill{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height:34px;
      padding:0 14px;
      border-radius:999px;
      border:1px solid var(--field-border);
      background:rgba(255,255,255,.92);
      font-weight:800;
      font-size:13px;
      color:var(--text-strong);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      white-space:nowrap;
    }
    body.paw-contracts .file-pill input[type="file"]{
      position:absolute;
      inset:0;
      opacity:0;
      cursor:pointer;
      width:100%;
      height:100%;
    }

    body.paw-contracts .file-note{
      font-size:12px;
      color:rgba(15,23,42,.60);
      line-height:1.2;
      white-space:nowrap;
    }

    body.paw-contracts .file-name{
      font-size:13px;
      font-weight:750;
      color:rgba(15,23,42,.82);
      max-width: 520px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    body.paw-contracts .file-name.muted{ opacity:.75; }

    /* Mobile: stack each row cleanly */
    @media (max-width: 560px){
      body.paw-contracts .contracts-row{
        flex-direction:column;
        align-items:stretch;
        gap:8px;
      }
      body.paw-contracts .stage-seg{ width:100%; }
      body.paw-contracts .stage-btn{ flex:1 1 0; }
      body.paw-contracts .file-pill{ width:100%; }
      body.paw-contracts .file-note{ white-space:normal; }
      body.paw-contracts .file-name{ max-width: 100%; }
    }
  </style>
</head>

<body class="paw-contracts">
  <div class="app">
    <div class="frame">
      <div class="panel">

        <div class="panel-topbar">
          <div class="topbar-row0">
            <div class="tool-subtitle">Understand contracts, summarize key terms, and talk through negotiation scenarios.</div>

            <div class="topbar-right">
              <div class="utility-pair paw-seg" role="group" aria-label="Tool utilities">
                <button id="reset" class="util-btn paw-seg__btn" type="button">Reset</button>
                <button id="tips" class="util-btn paw-seg__btn" type="button">Tips &amp; How To</button>
              </div>
            </div>
          </div>

          <!-- Controls (2 rows) -->
          <div class="contracts-controls" aria-label="Contracts controls">

            <!-- Row 1: File Stage -->
            <div class="contracts-row" aria-label="File stage row">
              <div class="contracts-label">File Stage:</div>
              <div class="stage-seg" role="group" aria-label="Contract stage">
                <button class="stage-btn" type="button" data-stage="blank" aria-pressed="false">Blank</button>
                <button class="stage-btn" type="button" data-stage="draft" aria-pressed="false">Draft</button>
                <button class="stage-btn primary" type="button" data-stage="executed" aria-pressed="true">Executed</button>
              </div>
            </div>

            <!-- Row 2: File Upload -->
            <div class="contracts-row" aria-label="File upload row">
              <div class="contracts-label">File Upload:</div>

              <div class="file-pill" title="Choose a PDF file">
                Choose PDF…
                <input id="file" type="file" accept="application/pdf" />
              </div>

              <div class="file-note">Digitally generated PDFs only.</div>
            </div>

            <!-- Optional: show selected file name (kept subtle) -->
            <div class="contracts-row" aria-label="Selected file row" style="gap:10px;">
              <div id="fileName" class="file-name muted">No file selected</div>
            </div>

          </div>
        </div>

        <!-- Chat area (UI only until Worker wiring) -->
        <div id="messages" class="messages" aria-live="polite"></div>

        <div class="composer">
          <textarea id="input" placeholder="Ask a question about a contract or talk through a negotiation scenario…"></textarea>
          <button id="send" class="send" aria-label="Send" type="button">
            <img src="https://paw-tools.pages.dev/paw.png" class="send-icon" alt="">
          </button>
        </div>

      </div>
    </div>
  </div>

  <script>
    /**
     * PAW Contracts — UI scaffold only (NOT wired to Worker yet)
     * ----------------------------------------------------------
     * What this script does (and does NOT do):
     * ✅ Stage toggle UI (Blank/Draft/Executed)
     * ✅ File chooser label + basic PDF validation
     * ✅ Reset + Tips (simple, local)
     * ✅ "Send" button shows a placeholder message (so layout can be tested in Circle)
     *
     * ❌ No API calls
     * ❌ No PDF parsing / analysis
     * ❌ No localStorage drafts (contracts are sensitive; we will decide later)
     *
     * FUTURE WIRING (next step):
     * - Replace the placeholder send behavior with tool-shell.js init + Worker calls.
     * - On file select: upload to Worker and "analyze on upload" (no Analyze button).
     */
    (function () {
      const stageState = { stage: "executed" }; // blank | draft | executed
      const MAX_FILE_MB = 10;
      const MAX_FILE_BYTES = MAX_FILE_MB * 1024 * 1024;

      const TIPS_TEXT =
`What you can do here
• Upload a contract to get a clear summary, key terms, and important dates
• Ask questions about specific clauses or timelines
• Talk through negotiation scenarios with or without a document

Contract stages (for uploads)
• Blank: Learn what a form is for and how it’s typically completed
• Draft: Review filled-in terms before sharing with a client
• Executed: Summarize the deal and organize next steps

File uploads
• Digitally generated PDFs only (DocuSign, Dotloop, SkySlope, etc.)
• Scanned or photographed documents aren’t supported`;

      const $messages = document.getElementById("messages");
      const $input = document.getElementById("input");
      const $send = document.getElementById("send");
      const $reset = document.getElementById("reset");
      const $tips = document.getElementById("tips");
      const $file = document.getElementById("file");
      const $fileName = document.getElementById("fileName");
      const stageBtns = Array.from(document.querySelectorAll(".stage-btn"));

      let currentFile = null;

      function escapeHtml(str) {
        return String(str || "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      function appendMessage(role, text) {
        if (!$messages) return;
        const wrap = document.createElement("div");
        wrap.className = "msg " + (role === "user" ? "user" : "ai");
        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.innerHTML = "<p>" + escapeHtml(text) + "</p>";
        wrap.appendChild(bubble);
        $messages.appendChild(wrap);
        $messages.scrollTop = $messages.scrollHeight;
      }

      function setStage(next) {
        stageState.stage = next;
        stageBtns.forEach((btn) => {
          const on = btn.dataset.stage === next;
          btn.classList.toggle("primary", on);
          btn.setAttribute("aria-pressed", on ? "true" : "false");
        });
      }

      stageBtns.forEach((btn) => {
        btn.addEventListener("click", () => setStage(btn.dataset.stage || "executed"));
      });

      function setFileLabel(file) {
        if (!$fileName) return;
        if (!file) {
          $fileName.textContent = "No file selected";
          $fileName.classList.add("muted");
          return;
        }
        const kb = Math.ceil(file.size / 1024);
        $fileName.textContent = file.name + " (" + kb + " KB)";
        $fileName.classList.remove("muted");
      }

      function clearFile() {
        currentFile = null;
        try { if ($file) $file.value = ""; } catch (_) {}
        setFileLabel(null);
      }

      if ($file) {
        $file.addEventListener("change", () => {
          const f = ($file.files && $file.files[0]) ? $file.files[0] : null;
          if (!f) { clearFile(); return; }

          if (f.type !== "application/pdf") {
            alert("Please upload a PDF.");
            clearFile();
            return;
          }

          if (f.size > MAX_FILE_BYTES) {
            alert("File is too large. Please upload a smaller PDF (max " + MAX_FILE_MB + "MB).");
            clearFile();
            return;
          }

          currentFile = f;
          setFileLabel(f);

          // Placeholder behavior for now (until Worker wiring):
          // We DO NOT analyze here yet, but we show the intended next step.
          appendMessage("ai", "File received (UI only). When wired, PAW will analyze this PDF on upload using the selected stage: " + stageState.stage + ".");
        });
      }

      if ($tips) {
        $tips.addEventListener("click", () => alert(TIPS_TEXT));
      }

      function fullReset() {
        setStage("executed");
        clearFile();
        if ($messages) $messages.innerHTML = "";
        if ($input) $input.value = "";
      }

      if ($reset) {
        $reset.addEventListener("click", () => {
          const hasAny =
            (currentFile != null) ||
            ($messages && $messages.childElementCount > 0) ||
            ($input && String($input.value || "").trim().length > 0) ||
            (stageState.stage !== "executed");

          if (hasAny) {
            const ok = window.confirm("Reset will clear this session and start fresh. Continue?");
            if (!ok) return;
          }
          fullReset();
        });
      }

      // Placeholder send (until Worker wiring)
      if ($send) {
        $send.addEventListener("click", () => {
          const t = $input ? String($input.value || "").trim() : "";
          if (!t) return;

          appendMessage("user", t);
          if ($input) $input.value = "";

          appendMessage(
            "ai",
            "UI only (not connected yet). Next step: wire to the Worker so I can answer questions and use the uploaded PDF context."
          );
        });
      }

      // Enter to send (matches the shared shell behavior)
      if ($input) {
        $input.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            if ($send) $send.click();
          }
        });
      }
    })();
  </script>
</body>
</html>
