<!doctype html>
<html lang="en">
<head>
  <!--
    PAW Embed Guard (required):
    ------------------------------------------------------------
    These pages are built for Circle embedding.
    If someone opens this page directly (not in an iframe), redirect to proagentworks.com.
    Keep this lightweight; no dependencies.

    NOTE:
    - tool-shell.js also enforces Circle-only behavior, but we keep this guard
      in the <head> so the page fails closed even if future edits remove JS.
  -->
  <script>
    (function () {
      try {
        if (window.top === window.self) {
          window.location.replace("https://proagentworks.com");
        }
      } catch (e) {
        // If cross-origin framing prevents access to window.top, fail closed.
        window.location.replace("https://proagentworks.com");
      }
    })();
  </script>

  <script>
    // PAW Embed Mode Guard (same intent as other tools)
    // ------------------------------------------------
    // Circle provides the outer card. The embedded tool must render "flat".
    // paw-ui.css switches to flat mode when html[data-embed="1"] is present.
    (function(){
      try{
        var params = new URLSearchParams(window.location.search);
        var isEmbedParam = params.get('embed') === '1';
        var isInIframe = (function(){ try{ return window.self !== window.top; } catch(e){ return true; } })();
        if(isEmbedParam || isInIframe){
          document.documentElement.setAttribute('data-embed','1');
        }
      }catch(e){}
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Works</title>

  <!-- Shared PAW styles (do not fork) -->
  <link rel="stylesheet" href="./paw-ui.css">

  <!--
    ProAgent Works — My Works (Circle-embedded page)
    ------------------------------------------------
    PURPOSE (Phase 1):
    - Teach the "intentional saving" model.
    - Provide the single system of record UI scaffold:
        Tabs: My Brand / Listings / Transactions
        Empty states + Create CTAs
        Delete confirmation modal (wired later when real data exists)

    IMPORTANT PRODUCT RULES (locked):
    - Nothing is saved automatically.
    - Deletion is permanent (confirm required, no undo, no archive).
    - This page owns storage/limits messaging (tools should not).

    WIRING NOTE (Phase 1):
    - This file is UI-only. No backend persistence.
    - The "Create" CTAs currently open a lightweight “Coming next” modal.
      Later phases will route these actions into real editors and My Works storage.
  -->
  <style>
    /* Scoped styles for My Works only (do NOT modify paw-ui.css here). */
    body.paw-mystuff .mystuff-wrap{
      /* Main workspace content */
      padding: 0 14px 18px;
    }

    body.paw-mystuff .mystuff-head{
      display:flex;
      flex-direction:column;
      gap:8px;
      padding: 10px 0 8px;
      /* No card chrome: this lives inside the hero header region */
    }
    body.paw-mystuff .mystuff-title{
      font-size:16px;
      font-weight:900;
      color: var(--text-strong);
      letter-spacing:-0.01em;
      margin:0;
    }
    body.paw-mystuff .mystuff-blurb{
      /* Subtle reminder text (not a headline) */
      margin: 0;
      font-size: 13.5px;
      font-weight: 600;
      color: rgba(15,23,42,.58);
      line-height: 1.45;
      max-width: 920px;
    }

    /* ------------------------------------------------------------
       My Works Hero (header workspace region)
       ------------------------------------------------------------
       Goal: one coherent header group (Saved Works + Tips + reminder + tabs)
       No extra container boxes; just a soft fade for legibility.
    */
    body.paw-mystuff .myworks-hero{
      /* Unified header group: no extra “shelf” backgrounds here. */
      padding: 0 14px 10px;
      background: transparent;
    }



    /* ==========================================================
       My Works — "Saved works" orientation banner (non-interactive)
       ------------------------------------------------------------
       PURPOSE:
       - Top-left in PAW tools signals something important.
       - On My Works, we use the same brand language (blue + paw)
         as a LOCATION/ORIENTATION marker (not a button).
       - Paw icon keeps the subtle one-time "hello" animation on load.
       ========================================================== */
    body.paw-mystuff .paw-savedworks-banner{
      display:inline-flex;
      align-items:center;
      gap:10px;
      height:34px;
      padding:0 14px;
      background: transparent;
      color:#ffffff;
      font-weight:900;
      font-size:18px;
      white-space:nowrap;
      user-select:none;
      cursor:default;
    }
    body.paw-mystuff .paw-savedworks-banner .works-paw{
      width:18px;
      height:18px;
      display:block;
      object-fit:contain;
      flex:0 0 auto;
      transform-origin: 50% 60%;
    }
    body.paw-mystuff .paw-savedworks-banner .works-paw.paw-hello{
      animation: pawHello 1.10s ease-out;
    }

    body.paw-mystuff .paw-savedworks-banner .savedworks-label{
      font-weight:900;
      letter-spacing:-0.01em;
    }

    /* Mobile: keep the banner full-width so it reads as "important" */
    body.paw-mystuff .paw-savedworks-banner{ width:100%; }

    /* Tabs: reuse the shared segmented pill aesthetic */
    body.paw-mystuff .tabs-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top: 16px; /* added space between header band and tabs */
    }

    body.paw-mystuff .tabs{
      display:flex;
      width: fit-content;
      min-width: min(520px, 100%);
    }

    body.paw-mystuff .tabs .tab-btn{
      flex:1 1 0;
      height: 40px;
      padding: 0 14px;
      border: 0;
      background: transparent;
      color: rgba(15,23,42,.82);
      font-weight: 900;
      font-size: 13.5px;
      cursor:pointer;
      white-space:nowrap;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: background .15s ease, color .15s ease;
    }
    body.paw-mystuff .tabs .tab-btn:hover{ background: rgba(15,23,42,.05); }
    body.paw-mystuff .tabs .tab-btn + .tab-btn{ border-left:1px solid rgba(15,23,42,.08); }
    body.paw-mystuff .tabs .tab-btn[aria-selected="true"]{
      background: rgba(5,195,249,.24);
      color: rgba(15,23,42,.92);
    }

    body.paw-mystuff .limits{
      font-size:12px;
      font-weight:650;
      color: rgba(15,23,42,.54);
      white-space:nowrap;
    }

    /* Content area */
    body.paw-mystuff .tab-panel{
      display:none;
      padding-top: 14px;
    }
    body.paw-mystuff .tab-panel.active{ display:block; }

    body.paw-mystuff .empty{
      /*
        CONTAINER POLICY (My Works):
        - Avoid card-on-card fatigue.
        - Keep the page feeling like one coherent workspace.
        - Use whitespace + subtle dividers instead of repeated boxes.
      */
      border: 0;
      background: transparent;
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      max-width: 980px;
    }

    body.paw-mystuff .mw-section{
      /* Whitespace > rules. Avoid harsh dividers. */
      padding: 0;
      margin-top: 18px;
      border: 0;
      max-width: 980px;
    }
    body.paw-mystuff .mw-section:first-child{ margin-top: 0; }

    body.paw-mystuff .mw-section-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    body.paw-mystuff .mw-title{
      margin:0;
      font-size: 14px;
      font-weight: 950;
      color: rgba(15,23,42,.92);
      letter-spacing:-0.01em;
    }
    body.paw-mystuff .mw-meta{
      margin-top:4px;
      font-size:12px;
      font-weight:650;
      color: rgba(15,23,42,.56);
    }

    body.paw-mystuff .mw-body{
      margin-top: 10px;
      font-size: 14px;
      font-weight: 600;
      color: rgba(15,23,42,.80);
      line-height: 1.45;
      max-width: 920px;
    }

    body.paw-mystuff .mw-kv{
      margin-top: 8px;
      display:grid;
      gap: 6px;
      font-size: 13.5px;
      font-weight: 600;
      color: rgba(15,23,42,.74);
    }
    body.paw-mystuff .mw-kv b{ font-weight: 750; color: rgba(15,23,42,.72); }

    /* ------------------------------------------------------------
       Saved Brand Settings (single cohesive unit)
       ------------------------------------------------------------
       - Brand Settings + Snapshot + Contact data are one saved object.
       - No “card” containers; grouping is done with spacing + type.
       - This unit can later be followed by additional saved brand items.
    */
    body.paw-mystuff .mw-brandunit{
      max-width: 980px;
    }
    body.paw-mystuff .mw-brandhead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    body.paw-mystuff .mw-brandtitle{
      margin:0;
      font-size: 15px;
      font-weight: 950;
      color: rgba(15,23,42,.92);
      letter-spacing:-0.01em;
    }
    body.paw-mystuff .mw-actions{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    body.paw-mystuff .mw-facet{
      margin-top: 14px;
    }

    
    /* ------------------------------------------------------------
       Brand Settings Inline Editor (accordion + compact growth)
       ------------------------------------------------------------ */
    body.paw-mystuff .hide{ display:none !important; }

    body.paw-mystuff .mw-editor{
      max-width: 980px;
      margin-top: 6px;
    }
    body.paw-mystuff .mw-editor-wrap{
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 16px;
      background: #fff;

      /* IMPORTANT (2026-01):
         This editor must NOT create an inner scroll container.
         My Works is designed to auto-expand in Circle.
         Therefore: do not set max-height + overflow:auto here.
         Let the document grow; the iframe height reporter will follow. */
      overflow: visible;
      max-height: none;
    }
    body.paw-mystuff .mw-editor-wrap.mw-grown{
      /* Retained for backward compatibility with earlier JS that toggles mw-grown.
         No-op by design: keep auto height + no inner scroll. */
      max-height: none;
    }
    body.paw-mystuff .mw-editor-top{
      padding: 14px 16px 10px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      background:
        radial-gradient(640px 220px at 20% 0%, rgba(14,165,233,.15), transparent 60%),
        radial-gradient(520px 180px at 85% 0%, rgba(59,130,246,.10), transparent 55%),
        linear-gradient(#fff, #fff);
    }
    body.paw-mystuff .mw-editor-title{
      font-size: 16px;
      font-weight: 950;
      letter-spacing:-0.01em;
      color: rgba(15,23,42,.92);
    }
    body.paw-mystuff .mw-editor-sub{
      margin: 6px 0 0;
      font-size: 13.5px;
      color: rgba(15,23,42,.72);
      line-height: 1.45;
      max-width: 920px;
    }

    body.paw-mystuff .mw-acc{ padding: 10px 12px 6px; }
    body.paw-mystuff .mw-acc-item{
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 14px;
      margin: 10px 0;
      overflow: hidden;
      background: rgba(248,250,252,.6);
    }
    body.paw-mystuff .mw-acc-toggle{
      width: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 11px 12px;
      background: rgba(255,255,255,.8);
      border: 0;
      cursor: pointer;
      font-weight: 850;
      color: rgba(15,23,42,.86);
      text-align:left;
    }
    body.paw-mystuff .mw-chev{
      display:inline-block;
      font-size: 14px;
      opacity: .7;
      transform: rotate(0deg);
      transition: transform .16s ease;
    }
    body.paw-mystuff .mw-acc-item.open .mw-chev{ transform: rotate(180deg); }

    body.paw-mystuff .mw-acc-panel{
      display:none;
      padding: 0 12px 12px;
      background: transparent;
    }
    body.paw-mystuff .mw-acc-item.open .mw-acc-panel{ display:block; }

    /* Reuse existing drawer-field styles for inputs, but make them feel native inline */
    body.paw-mystuff .mw-acc-panel .drawer-field{ padding-top: 10px; }

    body.paw-mystuff .mw-editor-foot{
      position: sticky;
      bottom: 0;
      z-index: 2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 14px;
      border-top: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(6px);
    }
/* ------------------------------------------------------------
       Desktop: Snapshot + Contact side-by-side
       ------------------------------------------------------------
       - Snapshot is the primary column (wider)
       - Contact data is secondary (slightly narrower, but still readable)
       - Collapses back to single column on smaller screens
    */
    body.paw-mystuff .mw-facets-grid{
      display:grid;
      grid-template-columns: minmax(0, 1.55fr) minmax(0, 1fr);
      gap: 28px;
      margin-top: 14px;
      align-items:start;
    }
    body.paw-mystuff .mw-facets-grid .mw-facet{ margin-top: 0; }

    @media (max-width: 860px){
      body.paw-mystuff .mw-facets-grid{
        grid-template-columns: 1fr;
        gap: 14px;
      }
    }
    body.paw-mystuff .mw-facet-label{
      font-size: 14px;              /* promoted snapshot header */
      font-weight: 900;
      color: rgba(15,23,42,.72);
      line-height: 1.25;
    }
    body.paw-mystuff .mw-facet-label .mw-label-sub{
      font-weight: 650;
      color: rgba(15,23,42,.52);
    }
    body.paw-mystuff .mw-facet-body{
      margin-top: 6px;
      font-size: 13px;              /* supporting body text */
      font-weight: 550;
      color: rgba(15,23,42,.78);
      line-height: 1.5;
      max-width: 920px;
    }

    /* Contact key/value list (label muted, value readable) */
    body.paw-mystuff .mw-contact{
      margin-top: 8px;
      display:grid;
      gap: 6px;
      max-width: 720px;
    }
    body.paw-mystuff .mw-contact > div{
      display:grid;
      grid-template-columns: 110px 1fr;
      column-gap: 12px;
      align-items: baseline;
    }
    body.paw-mystuff .mw-k{
      font-size: 12.5px;
      font-weight: 700;
      color: rgba(15,23,42,.58);
    }
    body.paw-mystuff .mw-v{
      font-size: 13.5px;
      font-weight: 600;
      color: rgba(15,23,42,.78);
      overflow-wrap: anywhere;
    }

    body.paw-mystuff .empty h3{
      margin:0;
      font-size:13px;
      font-weight: 950;
      color: var(--text-strong);
      letter-spacing:-0.01em;
    }
    body.paw-mystuff .empty p{
      margin:0 0 14px 0;
      font-size:14.5px;
      font-weight:600;
      color: rgba(15,23,42,.68);
      line-height:1.45;
      max-width: 760px;
    }
    body.paw-mystuff .empty .empty-actions{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-start;
      flex-wrap:wrap;
    }

    /* Small “future list” placeholder area (keeps layout stable once items exist) */
    body.paw-mystuff .list-placeholder{
      margin-top: 16px;
      padding: 0;
      border: 0;
      background: transparent;
      color: rgba(15,23,42,.56);
      font-size: 12px;
      line-height: 1.35;
      max-width: 980px;
    }

    @media (max-width: 560px){
  body.paw-mystuff .tool-head{ width:100%; }
  body.paw-mystuff .paw-savedworks-banner{ width:100%; }

  body.paw-mystuff .tabs-row{ flex-direction:column; align-items:stretch; gap:10px; }
  body.paw-mystuff .tabs{ width:100%; min-width:0; flex-direction:column; }

  /* Mobile: tabs become primary stacked actions */
  body.paw-mystuff .tabs .tab-btn{
    width:100%;
    justify-content:center;
    border-left: 0 !important;
  }
  body.paw-mystuff .tabs .tab-btn + .tab-btn{
    border-left:0;
    border-top:1px solid rgba(15,23,42,.10);
  }

  body.paw-mystuff .limits{ white-space:normal; text-align:left; }
}body.paw-mystuff .tabs{ width:100%; min-width:0; }
      body.paw-mystuff .limits{ white-space:normal; }
    }
  
    /* ------------------------------------------------------------
       Brand Settings Slide-Over (Phase 2 UI)
       ------------------------------------------------------------
       - Keeps Circle nav clean (no extra Circle pages)
       - UI-only: no persistence yet
       - Professional UX: backdrop, ESC close, focus return, internal scroll
    */
    body.paw-mystuff.drawer-open{
      overflow: hidden; /* prevent background scroll */
      touch-action: none;
    }
    body.paw-mystuff .drawer{
      position: fixed;
      inset: 0;
      display:none;
      z-index: 60;
    }
    body.paw-mystuff .drawer.show{ display:block; }
    body.paw-mystuff .drawer-backdrop{
      position:absolute;
      inset:0;
      background: rgba(2,6,23,.52);
      backdrop-filter: blur(2px);
    }
    body.paw-mystuff .drawer-panel{
      position:absolute;
      top: 10px;
      right: 10px;
      bottom: 10px;
      width: min(620px, calc(100vw - 20px));
      background: #fff;
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 16px;
      box-shadow: 0 28px 70px rgba(0,0,0,.22);
      overflow: hidden;

      transform: translateX(12px);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
      display:flex;
      flex-direction:column;
    }
    body.paw-mystuff .drawer.show .drawer-panel{
      transform: translateX(0);
      opacity: 1;
    }
    body.paw-mystuff .drawer-head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      background:
        radial-gradient(640px 220px at 20% 0%, rgba(5,195,249,.12), rgba(255,255,255,0) 60%),
        #ffffff;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    body.paw-mystuff .drawer-title{
      margin:0;
      font-size: 15px;
      font-weight: 950;
      color: var(--text-strong);
      letter-spacing:-0.01em;
      line-height:1.15;
    }
    body.paw-mystuff .drawer-sub{
      margin:6px 0 0 0;
      font-size: 12.5px;
      font-weight: 700;
      color: rgba(15,23,42,.68);
      line-height:1.35;
      max-width: 520px;
    }
    body.paw-mystuff .drawer-close{
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.92);
      width: 34px;
      height: 34px;
      border-radius: 10px;
      cursor:pointer;
      font-weight: 900;
      color: rgba(15,23,42,.72);
    }
    body.paw-mystuff .drawer-body{
      padding: 14px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    body.paw-mystuff .drawer-field{ margin-bottom: 14px; }
    body.paw-mystuff .drawer-field label{
      display:block;
      font-size: 13px;
      font-weight: 900;
      color: rgba(15,23,42,.92);
      margin-bottom: 6px;
      letter-spacing:-0.01em;
    }
    body.paw-mystuff .drawer-field .hint{
      font-size: 12px;
      font-weight: 700;
      color: rgba(15,23,42,.60);
      margin-bottom: 6px;
      line-height:1.35;
    }
    body.paw-mystuff .drawer-field input[type="text"],
    body.paw-mystuff .drawer-field textarea{
      width: 100%;
      border: 1px solid rgba(15,23,42,.16);
      border-radius: 12px;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 14px;
      outline: none;
      background: #fff;
    }
    body.paw-mystuff .drawer-field textarea{
      min-height: 96px;
      resize: vertical;
      line-height:1.35;
    }
    body.paw-mystuff .drawer-foot{
      padding: 12px 14px;
      border-top: 1px solid rgba(15,23,42,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      background: rgba(255,255,255,.98);
    }
    body.paw-mystuff .drawer-note{
      font-size: 12px;
      font-weight: 750;
      color: rgba(15,23,42,.60);
      line-height:1.25;
    }
    body.paw-mystuff .drawer-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap: wrap;
    }

    /* My Brand drawer: optional "Signature & Contact" section divider */
    body.paw-mystuff .drawer-section{
      margin: 18px 0 14px;
      padding-top: 14px;
      border-top: 1px dashed rgba(15,23,42,.16);
    }
    body.paw-mystuff .drawer-section-title{
      font-size: 13px;
      font-weight: 950;
      color: rgba(15,23,42,.92);
      letter-spacing:-0.01em;
      margin: 0 0 6px 0;
    }
    body.paw-mystuff .drawer-section-sub{
      font-size: 12px;
      font-weight: 700;
      color: rgba(15,23,42,.62);
      line-height: 1.35;
      margin: 0 0 10px 0;
    }

    /* Page-only header emphasis for My Works
       --------------------------------------
       FIXES:
       1) The gradient must start near the paw + "Saved Works" (top/left),
          then fade all the way to white across the header band.
       2) The "You've saved..." meter belongs bottom-right of the header.
       3) Mobile tabs must not inherit the big rounded segmented-pill shape.
    */
    body.paw-mystuff .panel-topbar.myworks-topbar{
      position: relative;           /* allow bottom-right limits placement */
      padding-bottom: 28px;         /* reserve space for bottom-right limits */
      background: #ffffff;          /* keep the full header area clean/white */
      border-radius: 18px 18px 0 0;
      overflow: hidden;
    }

    /* Apply the blue anchor glow ONLY to the top header row (Saved Works + Tips).
       This prevents the "blue slab" effect over the entire header region. */
    body.paw-mystuff .panel-topbar.myworks-topbar .topbar-row0{
      background:
        radial-gradient(720px 260px at 110px 12px,
          rgba(0,150,220,1) 0%,
          rgba(5,195,249,.70) 30%,
          rgba(255,255,255,0) 70%),
        #ffffff;
      border-radius: 18px 18px 0 0;
    }

    /* "You've saved..." meter pinned bottom-right inside the header container */
    body.paw-mystuff .panel-topbar.myworks-topbar .limits{
      position: absolute;
      right: 16px;
      bottom: 10px;
      white-space: nowrap;
      text-align: right;
      font-size: 12px;
      font-weight: 750;
      color: rgba(15,23,42,.58);
    }

    /* Ensure tabs row doesn't collide with the pinned limits */
    body.paw-mystuff .panel-topbar.myworks-topbar .myworks-hero{
      padding-bottom: 6px;
    }

    /* Mobile: convert tabs into clean stacked buttons (no giant capsule) */
    @media (max-width: 560px){
      body.paw-mystuff .panel-topbar.myworks-topbar{ padding-bottom: 34px; }

      body.paw-mystuff .panel-topbar.myworks-topbar .limits{
        right: 14px;
        bottom: 10px;
        white-space: normal; /* allow wrap if ultra narrow */
        max-width: calc(100% - 28px);
      }

      /* Override shared segmented pill styling on mobile */
      body.paw-mystuff .tabs.paw-seg{
        background: rgba(255,255,255,.92) !important;
        border: 1px solid rgba(15,23,42,.12) !important;
        border-radius: 14px !important;
        padding: 0 !important;
        overflow: hidden;
        box-shadow: none !important;
      }

      body.paw-mystuff .tabs .tab-btn{
        min-height: 44px;
        font-size: 14px;
        border-radius: 0 !important;
      }

      body.paw-mystuff .tabs .tab-btn[aria-selected="true"]{
        background: rgba(5,195,249,.18);
      }
    }

</style>
</head>

<body class="paw-mystuff">
  <div class="app">
    <div class="frame">
      <div class="panel">

        <!-- Top bar: keep the same shared structure (subtitle + utilities on right) -->
        <div class="panel-topbar myworks-topbar">
          <div class="topbar-row0">
            <div class="tool-head">
              <div class="paw-savedworks-banner is-static" aria-label="Saved works">
                <img class="works-paw" src="https://paw-tools.pages.dev/paw.png" alt="" aria-hidden="true">
                <span class="savedworks-label">Saved Works</span>
              </div>
            </div>

            <div class="topbar-right">
              <div class="utility-pair paw-seg" role="group" aria-label="My Works utilities">
                <button id="tips" class="util-btn paw-seg__btn" type="button">Tips &amp; How To</button>
              </div>
            </div>
          </div>


          <div class="myworks-hero">
            <div class="mystuff-head">
<div class="tabs-row">
                          <div class="tabs paw-seg" role="tablist" aria-label="My Works tabs">
                            <button class="tab-btn" id="tab-assets" role="tab" aria-selected="true" aria-controls="panel-assets" type="button">Brand Assets</button>
                            <button class="tab-btn" id="tab-listings" role="tab" aria-selected="false" aria-controls="panel-listings" type="button">Listings</button>
                            <button class="tab-btn" id="tab-transactions" role="tab" aria-selected="false" aria-controls="panel-transactions" type="button">Transactions</button>
                            <button class="tab-btn" id="tab-settings" role="tab" aria-selected="false" aria-controls="panel-settings" type="button">Brand Settings</button>
                          </div>

                          <!-- Phase 1: placeholder usage meter (non-technical, mocked) -->
                          <div class="limits" aria-label="Storage usage">
                            You’ve saved 0 of your available items.
                          </div>
                        </div>
                      </div>
          </div>
        </div>

        <div class="mystuff-wrap">

          

          <!-- Panels -->
          
          <section id="panel-assets" class="tab-panel active" role="tabpanel" aria-labelledby="tab-assets">
            <div class="empty">
              <h3>No saved Brand Assets yet</h3>
              <p>
                Brand Assets are saved brand content you’ve intentionally created — like bios, “About Me” versions,
                guides, blogs, or messaging frameworks. PAW never creates or changes these unless you save them.
              </p>
              <div class="empty-actions">
                <button class="btn primary" data-action="create-brand-asset" type="button">Create a Brand Asset</button>
              </div>
            </div>

            <div class="list-placeholder">
              <b>Coming next:</b> Saved brand assets will show up here as a simple list you can open, rename, or delete.
            </div>
          </section>


<section id="panel-settings" class="tab-panel" role="tabpanel" aria-labelledby="tab-settings">
            <div class="empty">
              <h3>Set up Brand Settings</h3>
              <p>
                Brand Settings tell PAW how to write and present you — voice, tone, audience, and optional contact details. PAW uses this automatically when it adds value.</p>
              <div class="empty-actions">
                <button class="btn primary" data-action="create-brand-settings" type="button">Set Up Brand Settings</button>
                              </div>
            </div>

            <div class="list-placeholder">
              <b>Coming next:</b> Once Brand Settings are saved, you can edit or delete them anytime.
            </div>
          </section>

          <section id="panel-listings" class="tab-panel" role="tabpanel" aria-labelledby="tab-listings">
            <div class="empty">
              <h3>No saved Listings yet</h3>
              <p>
                Save listing descriptions, property posts, or notes you want to reuse or build on later.
              </p>
              <div class="empty-actions">
                <button class="btn primary" data-action="create-listing" type="button">Create a Listing</button>
              </div>
            </div>

            <div class="list-placeholder">
              <b>Coming next:</b> Saved listings will show up as a simple list you can open, rename, or delete.
            </div>
          </section>

          <section id="panel-transactions" class="tab-panel" role="tabpanel" aria-labelledby="tab-transactions">
            <div class="empty">
              <h3>No saved Transactions yet</h3>
              <p>
                Save important contract work or transaction summaries so you can come back to them anytime.
              </p>
              <div class="empty-actions">
                <button class="btn primary" data-action="create-transaction" type="button">Create a Transaction</button>
              </div>
            </div>

            <div class="list-placeholder">
              <b>Coming next:</b> Transactions can exist with or without documents. You’ll name a transaction when you decide to save it.
            </div>
          </section>

        </div>
      </div>
    </div>
  </div>


  <!-- Tips & How To modal (PAW-owned; adds value beyond on-page reminder) -->
  <div id="tipsModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="tipsTitle">
      <div class="modal-head">
        <div id="tipsTitle" class="modal-title">Tips &amp; How To</div>
        <button class="modal-close" id="tipsClose" aria-label="Close" type="button">✕</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom:12px;"><b>PAW doesn’t save anything automatically.</b> My Works is where you intentionally save work you’ll want to reuse, revisit, or build on later — you choose what matters.</div>

        <ul class="tips-list" style="margin-top:0;">
          <li><b>Save when it took effort.</b> If you refined wording, gathered details, or nailed the tone — save it.</li>
          <li><b>Saved vs. not saved:</b> Drafts you don’t save aren’t kept here. If you want it later, save it.</li>
          <li><b>Edit anytime.</b> Updating an item changes what PAW will reuse going forward.</li>
          <li><b>Delete is permanent.</b> If you delete something from My Works, it’s removed and can’t be recovered.</li>
        </ul>

        <div style="margin-top:12px; font-size:13px; font-weight:650; color:rgba(15,23,42,.68); line-height:1.35;">
          <b>Quick examples:</b> Save a version of your bio you love, a listing description that worked, or a transaction summary you may reference later.
        </div>
      </div>
    </div>
  </div>

  <!-- “Coming next” modal for Create CTAs (Phase 1 placeholder) -->
  <div id="comingModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="comingTitle">
      <div class="modal-head">
        <div id="comingTitle" class="modal-title">Coming next</div>
        <button class="modal-close" id="comingClose" aria-label="Close" type="button">✕</button>
      </div>
      <div class="modal-body">
        <div id="comingBody" style="font-size:14px; color:rgba(15,23,42,.86); line-height:1.45;">
          This is a placeholder.
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
          <button class="btn primary" id="comingOk" type="button">Got it</button>
        </div>
      </div>
    </div>
  </div>



  <!-- My Brand delete confirmation (PAW-owned modal; avoid browser-native confirm) -->
  <div id="brandDeleteModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="brandDeleteTitle">
      <div class="modal-head">
        <div id="brandDeleteTitle" class="modal-title">Delete Brand Settings?</div>
        <button class="modal-close" id="brandDeleteClose" aria-label="Close" type="button">✕</button>
      </div>
      <div class="modal-body">
        <div style="font-size:14px; color:rgba(15,23,42,.86); line-height:1.45;">
          This permanently deletes your saved Brand Settings. This cannot be undone.
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px; flex-wrap:wrap;">
          <button class="btn" id="brandDeleteCancel" type="button">Cancel</button>
          <button class="btn primary" id="brandDeleteConfirm" type="button">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notice modal (fallback for messages when toast shell isn't available; avoid browser-native alert) -->
  <div id="noticeModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="noticeTitle">
      <div class="modal-head">
        <div id="noticeTitle" class="modal-title">Notice</div>
        <button class="modal-close" id="noticeClose" aria-label="Close" type="button">✕</button>
      </div>
      <div class="modal-body">
        <div id="noticeBody" style="font-size:14px; color:rgba(15,23,42,.86); line-height:1.45;">—</div>
        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
          <button class="btn primary" id="noticeOk" type="button">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ------------------------------------------------------------
       Brand Settings Slide-Over
       ------------------------------------------------------------
       NOTE:
       - This editor saves into My Works only when the user clicks Save.
       - Nothing is saved automatically.
       - This keeps Circle navigation clean and keeps My Brand always editable.
  -->
  

  <!-- Brand Settings editor is now inline in the Brand Settings tab (no overlay drawer). -->

<script src="/tool-shell.js"></script>

  <script>
    (function(){
      // ------------------------------------------------------------
      // Header "Saved works" paw — one-time hello animation
      // ------------------------------------------------------------
      // Uses the shared @keyframes pawHello from paw-ui.css.
      try{
        const paw = document.querySelector('.paw-savedworks-banner .works-paw');
        if (paw){
          setTimeout(() => {
            try{
              paw.classList.add('paw-hello');
              setTimeout(() => { try{ paw.classList.remove('paw-hello'); }catch(_){} }, 1200);
            }catch(_){}
          }, 450);
        }
      }catch(_){}

      // ------------------------------------------------------------
      // Tabs (Phase 1)
      // ------------------------------------------------------------
      const tabs = [
        { btn: document.getElementById('tab-assets'), panel: document.getElementById('panel-assets') },
        { btn: document.getElementById('tab-listings'), panel: document.getElementById('panel-listings') },
        { btn: document.getElementById('tab-transactions'), panel: document.getElementById('panel-transactions') },
        { btn: document.getElementById('tab-settings'), panel: document.getElementById('panel-settings') },
      ];

      function activateTab(btnId){
        tabs.forEach(t => {
          const on = t.btn && t.btn.id === btnId;
          if (t.btn) t.btn.setAttribute('aria-selected', on ? 'true' : 'false');
          if (t.panel) t.panel.classList.toggle('active', !!on);
        });
      }

      tabs.forEach(t => {
        if (!t.btn) return;
        t.btn.addEventListener('click', () => activateTab(t.btn.id));
      });

      // ------------------------------------------------------------
      // Modal helpers (reuse shared .modal styles from paw-ui.css)
      // ------------------------------------------------------------
      function openModal($m){
        try{
          if (!$m) return;
          $m.classList.add('show');
          $m.setAttribute('aria-hidden','false');
        }catch(_){}
      }
      function closeModal($m){
        try{
          if (!$m) return;
          $m.classList.remove('show');
          $m.setAttribute('aria-hidden','true');
        }catch(_){}
      }

      function wireBasicModal(modalId, openBtnId, closeBtnId){
        const $m = document.getElementById(modalId);
        const $open = document.getElementById(openBtnId);
        const $close = document.getElementById(closeBtnId);

        if ($open) $open.addEventListener('click', () => openModal($m));
        if ($close) $close.addEventListener('click', () => closeModal($m));
        if ($m) $m.addEventListener('click', (e) => { if (e.target === $m) closeModal($m); });
        return $m;
      }

      const $tips = wireBasicModal('tipsModal','tips','tipsClose');

      // Coming next modal (Create CTAs)
      const $coming = document.getElementById('comingModal');
      const $comingBody = document.getElementById('comingBody');
      const $comingClose = document.getElementById('comingClose');
      const $comingOk = document.getElementById('comingOk');

      // Brand delete confirmation + Notice modal (PAW-owned; no browser-native dialogs)
      const $brandDeleteModal = document.getElementById('brandDeleteModal');
      const $brandDeleteClose = document.getElementById('brandDeleteClose');
      const $brandDeleteCancel = document.getElementById('brandDeleteCancel');
      const $brandDeleteConfirm = document.getElementById('brandDeleteConfirm');

      const $notice = document.getElementById('noticeModal');
      const $noticeTitle = document.getElementById('noticeTitle');
      const $noticeBody = document.getElementById('noticeBody');
      const $noticeClose = document.getElementById('noticeClose');
      const $noticeOk = document.getElementById('noticeOk');


      
      // ------------------------------------------------------------
      // ------------------------------------------------------------
      // Brand Settings Inline Editor (Phase 4)
      // ------------------------------------------------------------
      // Why:
      // - Brand Settings are a "living profile" and should feel like part of My Works,
      //   not a blocking overlay.
      // - Saved view remains the same. Edit/Create swaps into an inline form
      //   with expandable sections (chevrons) to preserve the compact 520px feel.
      //
      // Guardrails:
      // - Nothing saves automatically. Save is explicit.
      // - Cancel always reverts back to the saved view (or empty intro).
      // - Markup is rendered dynamically inside the Brand Settings tab panel.

      let lastFocus = null;

      function enterBrandEditMode(triggerEl){
        try{
          lastFocus = triggerEl || document.activeElement;

          const panel = document.getElementById('panel-settings');
          if (!panel) return;

          panel.classList.add('mw-editing');

          const saved = panel.querySelector('#brandSavedView');
          const editor = panel.querySelector('#brandEditor');
          if (saved) saved.classList.add('hide');
          if (editor) editor.classList.remove('hide');

          // Focus first field for a professional feel
          const first = panel.querySelector('#mb_voice');
          setTimeout(() => { try{ first && first.focus(); }catch(e){} }, 30);
        }catch(e){}
      }

      function exitBrandEditMode(){
        try{
          const panel = document.getElementById('panel-settings');
          if (!panel) return;

          panel.classList.remove('mw-editing');

          const saved = panel.querySelector('#brandSavedView');
          const editor = panel.querySelector('#brandEditor');
          if (saved) saved.classList.remove('hide');
          if (editor) editor.classList.add('hide');

          // Restore focus
          setTimeout(() => { try{ lastFocus && lastFocus.focus && lastFocus.focus(); }catch(e){} }, 0);
        }catch(e){}
      }

      function wireBrandEditor(panel, opts){
        // opts: { mode: "create" | "edit" }
        try{
          if (!panel) return;

          // Accordion toggles
          const toggles = panel.querySelectorAll('[data-acc-toggle="1"]');
          toggles.forEach(btn => {
            btn.addEventListener('click', () => {
              try{
                const item = btn.closest('.mw-acc-item');
                if (!item) return;

                const isOpen = item.classList.contains('open');
                // Allow multiple open sections; just toggle this one
                item.classList.toggle('open', !isOpen);
                btn.setAttribute('aria-expanded', String(!isOpen));

                // Grow the editor area once the user engages with sections
                const wrap = panel.querySelector('#brandEditorWrap');
                if (wrap) wrap.classList.add('mw-grown');

                // Ask the parent iframe to re-measure after the accordion animation/layout settles
                try{
                  if (window.__PAW_REQUEST_HEIGHT__) {
                    window.__PAW_REQUEST_HEIGHT__(true);
                    setTimeout(function(){ window.__PAW_REQUEST_HEIGHT__(true); }, 180);
                  }
                }catch(_){ }
              }catch(e){}
            });
          });

          // Cancel
          const cancel = panel.querySelector('#mb_cancel');
          if (cancel){
            cancel.onclick = async () => {
              try{
                if (opts && opts.mode === "create"){
                  // Re-render to reset fields to empty state editor
                  renderBrandEmpty();
                } else {
                  // Return to saved view without persisting
                  exitBrandEditMode();
                }
              }catch(_){}
            };
          }

          // Save (explicit)
          const save = panel.querySelector('#mb_save');
          if (save){
            save.onclick = async () => {
              try{
                const brand = readBrandForm();
                await apiSaveBrand(brand);
                await refreshBrandUI();
                // After an explicit save, keep the user in Brand Settings so they
                // immediately see the saved-state snapshot (prevents confusion
                // that it "didn't save" when we auto-land on Brand Assets).
                try{ activateTab('tab-settings'); }catch(_){}
                toast('Brand Settings saved.');
              }catch(e){
                toast('Couldn’t save Brand Settings. Please try again.');
              }
            };
          }
        }catch(e){}
      }
// ------------------------------------------------------------
      // Phase 3: Backend wiring (Auth + Brand persistence)
      // ------------------------------------------------------------
      const API_ENDPOINT = "https://paw-api.joe-b40.workers.dev";

      function getAuthToken(){
        try { return (window.PAWAuth && window.PAWAuth.getToken) ? window.PAWAuth.getToken() : ""; } catch(_) { return ""; }
      }
      function toast(msg){
        // Prefer the shared shell toast when available.
        try{
          if (window.PAWToolShell && window.PAWToolShell._toast) { window.PAWToolShell._toast(msg); return; }
        }catch(_){}
        // Fallback: PAW-owned notice modal (avoid browser-native alert).
        try{ showNotice(String(msg||""), "Notice"); }catch(_){}
      }

      async function apiFetch(path, opts){
        const url = String(API_ENDPOINT).replace(/\/+$/,"") + path;
        const headers = Object.assign({ "Content-Type":"application/json" }, (opts && opts.headers) ? opts.headers : {});
        const t = getAuthToken();
        if (t) headers["Authorization"] = "Bearer " + t;

        const res = await fetch(url, Object.assign({}, opts, { headers }));
        const data = await res.json().catch(() => ({}));
        if (!res.ok){
          const msg = data && (data.error || data.message || data.reply) ? (data.error || data.message || data.reply) : ("Request failed ("+res.status+")");
          throw new Error(msg);
        }
        return data;
      }

      async function apiGetBrand(){
        return await apiFetch("/mystuff/brand", { method:"GET" });
      }
      async function apiGetBrandSummary(){
        return await apiFetch("/mystuff/brand/summary", { method:"GET" });
      }
      async function apiSaveBrand(brand){
        return await apiFetch("/mystuff/brand", { method:"POST", body: JSON.stringify({ brand: brand || {} }) });
      }
      async function apiDeleteBrand(){
        return await apiFetch("/mystuff/brand", { method:"DELETE" });
      }

      function readBrandForm(){
        return {

          voice_tone: String((document.getElementById('mb_voice')||{}).value || "").trim(),
          primary_audience: String((document.getElementById('mb_audience')||{}).value || "").trim(),
          about_you: String((document.getElementById('mb_about')||{}).value || "").trim(),
          what_makes_you_different: String((document.getElementById('mb_diff')||{}).value || "").trim(),
          professional_designations: String((document.getElementById('mb_desig')||{}).value || "").trim(),

          // Signature & Contact (optional)
          display_name: String((document.getElementById('mb_name')||{}).value || "").trim(),
          contact_phone: String((document.getElementById('mb_phone')||{}).value || "").trim(),
          contact_email: String((document.getElementById('mb_email')||{}).value || "").trim(),
          contact_website: String((document.getElementById('mb_website')||{}).value || "").trim(),
          market_city_state: String((document.getElementById('mb_market')||{}).value || "").trim(),
          license_number: String((document.getElementById('mb_license')||{}).value || "").trim(),
        };
      }

            function fillBrandForm(brand){
        const b = brand || {};
        try{ const el = document.getElementById('mb_voice'); if(el) el.value = b.voice_tone || ""; }catch(_){}
        try{ const el = document.getElementById('mb_audience'); if(el) el.value = b.primary_audience || ""; }catch(_){}
        try{ const el = document.getElementById('mb_about'); if(el) el.value = b.about_you || ""; }catch(_){}
        try{ const el = document.getElementById('mb_diff'); if(el) el.value = b.what_makes_you_different || ""; }catch(_){}
        try{ const el = document.getElementById('mb_desig'); if(el) el.value = b.professional_designations || ""; }catch(_){}

        // Signature & Contact (optional)
        try{ const el = document.getElementById('mb_name'); if(el) el.value = b.display_name || ""; }catch(_){}
        try{ const el = document.getElementById('mb_phone'); if(el) el.value = b.contact_phone || ""; }catch(_){}
        try{ const el = document.getElementById('mb_email'); if(el) el.value = b.contact_email || ""; }catch(_){}
        try{ const el = document.getElementById('mb_website'); if(el) el.value = b.contact_website || ""; }catch(_){}
        try{ const el = document.getElementById('mb_market'); if(el) el.value = b.market_city_state || ""; }catch(_){}
        try{ const el = document.getElementById('mb_license'); if(el) el.value = b.license_number || ""; }catch(_){}
      }
      function escapeHtml(str){
        return String(str||"")
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#39;");
      }

      function safePreview(str, max){
        const s = String(str||"").trim().replace(/\s+/g," ");
        if(!max) return s;
        return s.length > max ? (s.slice(0, max-1) + "…") : s;
      }

      function setLimitsText(n){
        const el = document.querySelector('.limits');
        if (!el) return;
        el.textContent = "You’ve saved " + String(n||0) + " of your available items.";
      }

      
      
      // ------------------------------------------------------------
      // Brand Settings Editor Markup (inline)
      // ------------------------------------------------------------
      // NOTE:
      // - Uses the same field IDs as earlier versions (mb_*) so existing
      //   readBrandForm() and fillBrandForm() continue to work.
      // - Sections are collapsible to keep the panel compact by default.
      function buildBrandEditorHtml(mode){
        const isCreate = mode === "create";
        return `
          <div id="brandEditor" class="mw-editor ${isCreate ? "" : "hide"}">
            <div id="brandEditorWrap" class="mw-editor-wrap">
              <div class="mw-editor-top">
                <div class="mw-editor-title">${isCreate ? "Set up Brand Settings" : "Edit Brand Settings"}</div>
                <div class="mw-editor-sub">
                  These settings help PAW write like you — and generate bios, profiles, and “About Me” content.
                  You can update this anytime.
                </div>
              </div>

              <div class="mw-acc">
                <div class="mw-acc-item open">
                  <button type="button" class="mw-acc-toggle" data-acc-toggle="1" aria-expanded="true">
                    Voice &amp; Audience <span class="mw-chev">▾</span>
                  </button>
                  <div class="mw-acc-panel">
                    <div class="drawer-field">
                      <label for="mb_voice">Voice &amp; Tone</label>
                      <div class="hint">How should PAW generally sound when writing as you?</div>
                      <input id="mb_voice" type="text" placeholder="Example: Professional, friendly, confident" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_audience">Primary Audience</label>
                      <div class="hint">Who are you most often speaking to?</div>
                      <input id="mb_audience" type="text" placeholder="Example: First-time buyers, sellers, relocations" autocomplete="off">
                    </div>
                  </div>
                </div>

                <div class="mw-acc-item">
                  <button type="button" class="mw-acc-toggle" data-acc-toggle="1" aria-expanded="false">
                    About You <span class="mw-chev">▾</span>
                  </button>
                  <div class="mw-acc-panel">
                    <div class="drawer-field">
                      <label for="mb_about">About You</label>
                      <div class="hint">In your own words, how would you describe yourself as an agent?</div>
                      <textarea id="mb_about" placeholder="A few sentences is plenty. This doesn’t need to be perfect."></textarea>
                    </div>

                    <div class="drawer-field">
                      <label for="mb_diff">What Makes You Different</label>
                      <div class="hint">Anything you want highlighted or emphasized.</div>
                      <textarea id="mb_diff" placeholder="Experience, local expertise, communication style, background, approach, etc."></textarea>
                    </div>
                  </div>
                </div>

                <div class="mw-acc-item">
                  <button type="button" class="mw-acc-toggle" data-acc-toggle="1" aria-expanded="false">
                    Professional Details <span class="mw-chev">▾</span>
                  </button>
                  <div class="mw-acc-panel">
                    <div class="drawer-field">
                      <label for="mb_desig">Professional Designations (Optional)</label>
                      <div class="hint">Enter exactly how you want them to appear after your name. Example: <b>CRS, GRI</b></div>
                      <input id="mb_desig" type="text" placeholder="CRS, GRI" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_license">License / Brokerage (Optional)</label>
                      <div class="hint">Include anything you want on-profile (license #, brokerage name, etc.).</div>
                      <input id="mb_license" type="text" placeholder="Example: ABC Realty • NC Lic #12345" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_market">Market Served (Optional)</label>
                      <div class="hint">Where do you primarily serve?</div>
                      <input id="mb_market" type="text" placeholder="Example: Hendersonville, NC and surrounding areas" autocomplete="off">
                    </div>
                  </div>
                </div>

                <div class="mw-acc-item">
                  <button type="button" class="mw-acc-toggle" data-acc-toggle="1" aria-expanded="false">
                    Signature &amp; Contact <span class="mw-chev">▾</span>
                  </button>
                  <div class="mw-acc-panel">
                    <div class="drawer-field">
                      <label for="mb_name">Display Name (Optional)</label>
                      <div class="hint">How you want your name shown in content and signatures.</div>
                      <input id="mb_name" type="text" placeholder="Example: Joe Ballarino" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_email">Email (Optional)</label>
                      <input id="mb_email" type="email" placeholder="name@domain.com" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_phone">Phone (Optional)</label>
                      <input id="mb_phone" type="tel" placeholder="(555) 555-5555" autocomplete="off">
                    </div>

                    <div class="drawer-field">
                      <label for="mb_website">Website (Optional)</label>
                      <input id="mb_website" type="text" placeholder="Example: YourSite.com" autocomplete="off">
                    </div>
                  </div>
                </div>
              </div>

              <div class="mw-editor-foot">
                <div class="drawer-note">Future content will use your latest Brand Settings.</div>
                <div class="drawer-actions">
                  <button class="btn" id="mb_cancel" type="button">${isCreate ? "Reset" : "Cancel"}</button>
                  <button class="btn primary" id="mb_save" type="button">Save Brand Settings</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }
function renderBrandSaved(brand, meta){
        // My Works is a "saved items" view, not a raw data dump.
        // We show a single saved Brand Settings entry + two helpful previews:
        //  - PAW’s snapshot (derived, not saved)
        //  - Contact data (derived display of fields the user chose to provide)
        const panel = document.getElementById('panel-settings');
        if (!panel) return;

        // Ensure saved view is the default state after any refresh.
        try{ panel.classList.remove('mw-editing'); }catch(_){}


        const b = brand || {};
        const updated = (meta && meta.updated_at) ? String(meta.updated_at) : "";
        const updatedNice = updated ? (new Date(updated)).toLocaleString() : "";

        // Contact data preview (only show fields that exist)
        const bits = [];
        if (b.display_name) bits.push(`<div><span class="mw-k">Name</span><span class="mw-v">${escapeHtml(safePreview(b.display_name, 60))}</span></div>`);
        if (b.contact_email) bits.push(`<div><span class="mw-k">Email</span><span class="mw-v">${escapeHtml(safePreview(b.contact_email, 80))}</span></div>`);
        if (b.contact_phone) bits.push(`<div><span class="mw-k">Phone</span><span class="mw-v">${escapeHtml(safePreview(b.contact_phone, 60))}</span></div>`);
        if (b.contact_website) bits.push(`<div><span class="mw-k">Website</span><span class="mw-v">${escapeHtml(safePreview(b.contact_website, 120))}</span></div>`);
        if (b.market_city_state) bits.push(`<div><span class="mw-k">Serving</span><span class="mw-v">${escapeHtml(safePreview(b.market_city_state, 80))}</span></div>`);
        const contactHtml = bits.length
          ? `<div class="mw-facet">
               <div class="mw-facet-label">Contact data</div>
               <div class="mw-contact">
                 ${bits.join("")}
               </div>
             </div>`
          : ``;

        panel.innerHTML = `
          <div id="brandSavedView">
            <div class="mw-brandunit">
            <div class="mw-brandhead">
              <div>
                <h3 class="mw-brandtitle">Brand Settings</h3>
                <div class="mw-meta">
                  Saved${updatedNice ? ` • Last updated: ${escapeHtml(updatedNice)}` : ``}
                </div>
              </div>

              <div class="mw-actions">
                <button class="btn primary" id="brandEditBtn" type="button">Edit</button>
                <button class="btn" id="brandDeleteBtn" type="button">Delete</button>
              </div>
            </div>

            
            <div class="mw-facets-grid">
              <div class="mw-facet">
                <div class="mw-facet-label">PAW’s Snapshot</div>
                <div id="brandSmartSummary" class="mw-facet-body">
                  Writing your brand snapshot<span class="paw-dots"><span class="paw-dot"></span><span class="paw-dot"></span><span class="paw-dot"></span></span>
                </div>
              </div>

              ${contactHtml}
            </div>
</div>
          </div>
          ${buildBrandEditorHtml("edit")}
        `;

        // Wire editor (accordion + Save/Cancel)
        try{ wireBrandEditor(panel, { mode: "edit" }); }catch(_){ }

        // Wire actions
        const editBtn = document.getElementById('brandEditBtn');
        if (editBtn) {
          editBtn.addEventListener('click', () => {
            fillBrandForm(b);
            enterBrandEditMode(editBtn);
          });
        }

        const delBtn = document.getElementById('brandDeleteBtn');
        if (delBtn) {
          delBtn.addEventListener('click', async () => {
            // Always use PAW-owned modal for destructive confirmations (avoid browser-native confirm).
            openModal($brandDeleteModal);

            // Confirm action (overwrite to prevent stacking)
            if ($brandDeleteConfirm) {
              $brandDeleteConfirm.onclick = async () => {
                closeModal($brandDeleteModal);
                try{
                  await apiDeleteBrand();
                  await refreshBrandUI();
                  toast("Brand Settings deleted.");
                }catch(e){
                  toast("Couldn’t delete Brand Settings. Please try again.");
                }
              };
            }
          });
        }

        // Generate the smart snapshot (derived, not saved)
        try { refreshBrandSmartSummary(); } catch (_) {}
      }

      function renderBrandEmpty(){

        // Inline setup experience (no overlay):
        // - Users land directly in the Brand Settings tab.
        // - The form is collapsible to keep the panel compact.
        const panel = document.getElementById('panel-settings');
        if (!panel) return;

        panel.innerHTML = buildBrandEditorHtml("create");

        // Ensure a clean slate
        try{ fillBrandForm({}); }catch(_){}

        // Wire editor (accordion + Save/Reset)
        try{ wireBrandEditor(panel, { mode: "create" }); }catch(_){}

        // Make sure we're in "editing" mode visually
        try{ panel.classList.add('mw-editing'); }catch(_){}
      }

      async function refreshBrandUI(){
        try{
          const data = await apiGetBrand();

          // Landing behavior (approved):
          // - If Brand Settings do NOT exist yet, land the user on Brand Settings
          //   so they see the setup prompt immediately.
          // - If Brand Settings exist, land on Brand Assets (saved-content first).
          if (data && data.exists) {
            renderBrandSaved(data.brand || {}, data.meta || {});
            setLimitsText(1);
            activateTab('tab-assets');
          } else {
            renderBrandEmpty();
            setLimitsText(0);
            activateTab('tab-settings');
          }
        }catch(_){
          // If auth isn't ready yet, keep the existing UI.
        }
      }

      async function refreshBrandSmartSummary(){
        try{
          const el = document.getElementById('brandSmartSummary');
          if (el) {
            el.innerHTML = 'Writing your brand snapshot<span class="paw-dots"><span class="paw-dot"></span><span class="paw-dot"></span><span class="paw-dot"></span></span>';
          }
          const data = await apiGetBrandSummary();
          const txt = data && typeof data.summary === "string" ? data.summary.trim() : "";
          if (el) el.textContent = txt || "Saved — ready to use when it adds value.";
        }catch(_){
          const el = document.getElementById('brandSmartSummary');
          if (el) el.textContent = "Saved — ready to use when it adds value.";
        }
      }

function showComing(msg){
        if ($comingBody) $comingBody.textContent = msg;
        openModal($coming);
      }

      function showNotice(msg, title){
        if ($noticeTitle) $noticeTitle.textContent = String(title || "Notice");
        if ($noticeBody) $noticeBody.textContent = String(msg || "");
        openModal($notice);
      }

      // Notice modal wiring
      if ($noticeClose) $noticeClose.addEventListener('click', () => closeModal($notice));
      if ($noticeOk) $noticeOk.addEventListener('click', () => closeModal($notice));
      if ($notice) $notice.addEventListener('click', (e) => { if (e.target === $notice) closeModal($notice); });

      // Brand delete modal wiring
      function closeBrandDeleteModal(){ closeModal($brandDeleteModal); }
      if ($brandDeleteClose) $brandDeleteClose.addEventListener('click', closeBrandDeleteModal);
      if ($brandDeleteCancel) $brandDeleteCancel.addEventListener('click', closeBrandDeleteModal);
      if ($brandDeleteModal) $brandDeleteModal.addEventListener('click', (e) => { if (e.target === $brandDeleteModal) closeBrandDeleteModal(); });


      if ($comingClose) $comingClose.addEventListener('click', () => closeModal($coming));
      if ($comingOk) $comingOk.addEventListener('click', () => closeModal($coming));
      if ($coming) $coming.addEventListener('click', (e) => { if (e.target === $coming) closeModal($coming); });

      
      /**
       * PAW Navigation Bridge (Circle parent-controlled navigation)
       * ---------------------------------------------------------
       * These tool pages run inside an embedded context where direct top-frame navigation
       * (window.top.location / window.open(..., '_top')) is frequently blocked.
       *
       * Instead, we ask the Circle parent shell to navigate using postMessage.
       * The parent listener (Circle → Site → Code snippets → JavaScript) will:
       *  - validate origin
       *  - allowlist destinations
       *  - ACK the request (paw_navigate_ack_v1)
       *  - navigate the Circle shell to the correct tool page
       *
       * Fallback:
       * If the parent listener is missing or blocked, we open the destination in a new tab.
       * This ensures the buttons never appear "dead".
       */
      function pawNavigate(destinationKey){
        const DEST = String(destinationKey || '').toUpperCase();
        const ACK = 'paw_navigate_ack_v1';
        const REQ = 'paw_navigate_request_v1';

        // We intentionally do NOT implement a time-based fallback that opens a new tab.
        // Reason: the Circle parent navigates immediately, which can unload this iframe
        // before an ACK is processed — causing false fallbacks and janky UX.
        //
                let acked = false;

        const onAck = (ev) => {
          try{
            if (!ev || !ev.data || ev.data.type !== ACK) return;
            if (String(ev.data.destination || '').toUpperCase() !== DEST) return;
            acked = true;
            try { window.removeEventListener('message', onAck); } catch(_) {}
            // Parent will navigate the Circle shell.
          }catch(_){}
        };

        try { window.addEventListener('message', onAck); } catch(_) {}

        try{
          // Use "*" because the parent bridge validates origin; we may be embedded under
          // proagentworks.com even though the HTML is hosted on paw-tools.pages.dev.
          window.parent.postMessage({ type: REQ, destination: DEST }, '*');
        }catch(_){
          // If postMessage fails entirely, do nothing. (Parent bridge should exist in Circle.)
        }

      }


document.addEventListener('click', (e) => {
        const el = e.target;
        if (!el || !el.matches) return;
        if (!el.matches('[data-action]')) return;

        const a = el.getAttribute('data-action') || '';
        if (a === 'create-brand-settings') { try{ activateTab('tab-settings'); renderBrandEmpty(); }catch(_){} return; }
        if (a === 'create-brand-asset') { pawNavigate('PRESENCE'); return; }
        if (a === 'learn-brand') showComing('Next: examples + a guided setup that makes it easy to capture your voice and bio details.');
        if (a === 'create-listing') { pawNavigate('LISTINGS'); return; }
        if (a === 'create-transaction') { pawNavigate('TRANSACTIONS'); return; }
      });

      // Escape key closes whichever modal is open
      document.addEventListener('keydown', (e) => {
        if (e.key !== 'Escape') return;
        [$tips,$coming,$brandDeleteModal,$notice].forEach(m => closeModal(m));
        /* no drawer in My Works (inline editor) */
      });

    

      // ------------------------------------------------------------
      // Boot: initialize auth and load saved Brand Settings (if any)
      // ------------------------------------------------------------
      try{
        if (window.PAWToolShell && window.PAWToolShell.authInit) {
          window.PAWToolShell.authInit(API_ENDPOINT);
        }
        // Refresh once token is available (or immediately if already ready).
        if (window.PAWAuth && window.PAWAuth.whenReady) {
          window.PAWAuth.whenReady().then(() => refreshBrandUI()).catch(() => {});
        } else {
          refreshBrandUI();
        }
      }catch(_){}

})();
  </script>

  <script>
/**
 * PAW Iframe Height Reporter (v1.1 - loop-safe)
 * ------------------------------------------------------------
 * Sends the tool's *content* height to the Circle parent.
 * Avoids runaway loops caused by viewport-based CSS (e.g. 100vh).
 *
 * Contract:
 * - Sends: { type: "paw_iframe_height_request_v1", height: <number> }
 */
(function () {
  if (window.__PAW_HEIGHT_REPORTER_V11__) return;
  window.__PAW_HEIGHT_REPORTER_V11__ = true;

  var lastSent = 0;
  var rafPending = false;
  var IGNORE_DELTA_PX = 8;

  function px(n){ n = Number(n); return isFinite(n) ? n : 0; }

  function measureContentHeight() {
    try {
      // Prefer the visible "app" content container if present
      // (Most PAW tools have: .app > .frame > .panel)
      var panel = document.querySelector(".panel");
      if (panel && panel.getBoundingClientRect) {
        var r = panel.getBoundingClientRect();
        return Math.ceil(px(r.height));
      }

      // Fallback: sum key areas if present
      var topbar = document.querySelector(".panel-topbar");
      var messages = document.getElementById("messages") || document.querySelector(".messages");
      var composer = document.querySelector(".composer");

      var h = 0;
      if (topbar && topbar.getBoundingClientRect) h += px(topbar.getBoundingClientRect().height);
      if (messages && messages.getBoundingClientRect) h += px(messages.getBoundingClientRect().height);
      if (composer && composer.getBoundingClientRect) h += px(composer.getBoundingClientRect().height);

      if (h > 0) return Math.ceil(h);

      // Last-resort fallback (works for simpler pages)
      var d = document.documentElement;
      return Math.ceil(Math.max(px(d.scrollHeight), px(d.offsetHeight)));
    } catch (_) {
      return 0;
    }
  }

  function postHeight(force) {
    var h = measureContentHeight();
    if (!h) return;

    if (!force && Math.abs(h - lastSent) < IGNORE_DELTA_PX) return;
    lastSent = h;

    try {
      window.parent.postMessage(
        { type: "paw_iframe_height_request_v1", height: h },
        "*"
      );
    } catch (_) {}
  }

  function schedule(force) {
    if (rafPending) return;
    rafPending = true;
    requestAnimationFrame(function () {
      rafPending = false;
      postHeight(force);
    });
  }

  // Expose a safe, idempotent height refresh hook for in-page UI toggles
  // (e.g., accordion sections expanding/collapsing) so the parent iframe can resize.
  window.__PAW_REQUEST_HEIGHT__ = schedule;

  // Initial + settle passes
  schedule(true);
  setTimeout(function(){ schedule(true); }, 120);
  setTimeout(function(){ schedule(true); }, 400);

  // DOM changes (tabs, modals, drawer open/close, async content)
  try {
    var mo = new MutationObserver(function(){ schedule(false); });
    mo.observe(document.body, { childList:true, subtree:true, characterData:true, attributes:true });
  } catch (_) {}

  // Images loading after insertion
  document.addEventListener("load", function(e){
    try { if (e.target && e.target.tagName === "IMG") schedule(false); } catch (_) {}
  }, true);

  // Resize/orientation/keyboard changes
  window.addEventListener("resize", function(){ schedule(true); });
})();
</script>

</body>
</html>
